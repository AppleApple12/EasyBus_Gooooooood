Index: app/src/main/java/com/example/easybus/Urls.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.easybus;\r\nimport java.net.InetAddress;\r\nimport java.net.UnknownHostException;\r\n\r\npublic class Urls {\r\n    //private static InetAddress ip;/////urllll\r\n    public static String url1 = \"http://172.20.10.3\";\r\n    //public static String url1 = \"http://8c708b26959c.ngrok.io\";\r\n    public static void main(String args[]) {\r\n\r\n        /*try {\r\n            ip = InetAddress.getLocalHost();\r\n            System.out.println(ip.getHostAddress());\r\n        } catch (UnknownHostException e) {\r\n            e.printStackTrace();\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n        }*/\r\n\r\n\r\n\r\n    }\r\n    //static String ROOT_URL = url1+url2+url3;\r\n    //static String FORGOT_PASSWORD_URL = \"http://192.168.27.107/LoginRegister/\" + \"forgot.php\";\r\n//搞不清楚 你不是說要用appple 對阿 可是不能merge 現在又說EasyBus 有問題\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/easybus/Urls.java	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
+++ app/src/main/java/com/example/easybus/Urls.java	(date 1628843807629)
@@ -4,7 +4,7 @@
 
 public class Urls {
     //private static InetAddress ip;/////urllll
-    public static String url1 = "http://172.20.10.3";
+    public static String url1 = "http://192.168.0.126";
     //public static String url1 = "http://8c708b26959c.ngrok.io";
     public static void main(String args[]) {
 
Index: .idea/shelf/Uncommitted_changes_before_Merge_at_2021_8_5_下午_04_51_[Default_Changelist]/shelved.patch
===================================================================
--- .idea/shelf/Uncommitted_changes_before_Merge_at_2021_8_5_下午_04_51_[Default_Changelist]/shelved.patch	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
+++ .idea/shelf/Uncommitted_changes_before_Merge_at_2021_8_5_下午_04_51_[Default_Changelist]/shelved.patch	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
@@ -1,74 +0,0 @@
-Index: app/src/main/java/com/example/easybus/Page5012Activity.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>package com.example.easybus;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.ActionBar;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport android.app.ProgressDialog;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.ColorMatrix;\r\nimport android.graphics.ColorMatrixColorFilter;\r\nimport android.graphics.drawable.ColorDrawable;\r\nimport android.os.Bundle;\r\nimport android.util.Base64;\r\nimport android.view.Gravity;\r\nimport android.view.LayoutInflater;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.PopupWindow;\r\nimport android.widget.RelativeLayout;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.android.volley.AuthFailureError;\r\nimport com.android.volley.Request;\r\nimport com.android.volley.RequestQueue;\r\nimport com.android.volley.Response;\r\nimport com.android.volley.VolleyError;\r\nimport com.android.volley.toolbox.JsonObjectRequest;\r\nimport com.android.volley.toolbox.StringRequest;\r\nimport com.android.volley.toolbox.Volley;\r\n\r\nimport org.json.JSONArray;\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\npublic class Page5012Activity extends AppCompatActivity {\r\n    //12345\r\n    private static final String DIRECTION_URL_API = \"https://maps.googleapis.com/maps/api/directions/json?\";\r\n    private static final String GOOGLE_API_KEY = \"AIzaSyCr_-3KbvHxSm9Gb38l7M2E_b8qzwHhcTI\";\r\n    String url,urlOrigin,urlDestination,title2,getmail;\r\n    ImageView mImg,mBack,mAdd;\r\n    RecyclerView recyclerView;\r\n    BusInfoAdaptor adaptor;\r\n    ArrayList<BusInfo> businfos;\r\n    RequestQueue requestQueue;\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_page5012);\r\n\r\n        //隱藏title bar\r\n        ActionBar actionBar = getSupportActionBar();\r\n        actionBar.hide();\r\n\r\n        //取值(origin,destination)\r\n        Bundle bundle = getIntent().getExtras();\r\n        urlOrigin= bundle.getString(\"origin2\");\r\n        urlDestination= bundle.getString(\"destination2\");\r\n\r\n        url=DIRECTION_URL_API+\"origin=\"+urlOrigin+\"&destination=\"+urlDestination+\"&mode=transit&transit_mode=bus&language=zh-TW&key=\"+GOOGLE_API_KEY;\r\n        System.out.println(url);\r\n        mImg=findViewById(R.id.img);\r\n        mBack=findViewById(R.id.backicon);\r\n        mAdd=findViewById(R.id.addIcon);\r\n        recyclerView=findViewById(R.id.busInfo);\r\n\r\n        recyclerView.setLayoutManager(new LinearLayoutManager(this));\r\n        adaptor=new BusInfoAdaptor();\r\n        recyclerView.setAdapter(adaptor);\r\n        businfos=new ArrayList<>();\r\n        getData();\r\n        SharedPreferences email = getSharedPreferences(\"email\",MODE_PRIVATE);\r\n        getmail=email.getString(\"Email\",\"\");\r\n        requestQueue = Volley.newRequestQueue(this);\r\n\r\n        mAdd.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                //實例化mPopupWindow\r\n                popupWindow popupWin=new popupWindow(Page5012Activity.this);\r\n                View view= LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupwindow,null);\r\n                //設計彈出框\r\n                popupWin.showAtLocation(view,Gravity.CENTER,0,0);\r\n\r\n            }\r\n        });\r\n\r\n        mBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                finish();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void getData() { //抓公車JSON\r\n        final ProgressDialog progressDialog=new ProgressDialog(this);\r\n        progressDialog.setMessage(\"載入中...\");\r\n        progressDialog.show();\r\n\r\n        final JsonObjectRequest jsonObjectRequest=new JsonObjectRequest(url,null, new Response.Listener<JSONObject>() {\r\n            @Override\r\n            public void onResponse(JSONObject response) {\r\n                try{\r\n                    JSONArray ArrayRoutes = response.getJSONArray(\"routes\");\r\n                    JSONArray ArrayLegs =ArrayRoutes.getJSONObject(0).getJSONArray(\"legs\");\r\n                    JSONArray ArraySteps =ArrayLegs.getJSONObject(0).getJSONArray(\"steps\");\r\n\r\n                    for(int i=0;i<ArraySteps.length();i++){\r\n                        JSONObject ObjSteps=ArraySteps.getJSONObject(i);\r\n                        String travelMode=ObjSteps.getString(\"travel_mode\");\r\n                        BusInfo businfo=new BusInfo();\r\n\r\n                        if (travelMode.equals(\"WALKING\")) {\r\n                            String Htmlinstructions=ObjSteps.getString(\"html_instructions\");\r\n                            businfo.setHtmlinstructions(Htmlinstructions.substring(3));\r\n                            businfo.setShortname(null);\r\n                            businfo.setPic(1);\r\n                        }else{\r\n                            businfo.setHtmlinstructions (ObjSteps.getJSONObject(\"transit_details\").getJSONObject(\"arrival_stop\").getString(\"name\"));\r\n                            businfo.setShortname(ObjSteps.getJSONObject(\"transit_details\").getJSONObject(\"line\").getString(\"short_name\"));\r\n                            businfo.setPic(0);\r\n                        }\r\n                        businfos.add(businfo);\r\n                    }\r\n                }catch (JSONException e){\r\n                    Toast.makeText(Page5012Activity.this,e.getMessage()+\"錯誤1\",Toast.LENGTH_LONG).show();\r\n                }\r\n                adaptor.setData(businfos);\r\n                adaptor.notifyDataSetChanged();\r\n                progressDialog.dismiss();\r\n            }\r\n        }, new Response.ErrorListener() {\r\n            @Override\r\n            public void onErrorResponse(VolleyError error) {\r\n                progressDialog.dismiss();\r\n                Toast.makeText(Page5012Activity.this,\"發生錯誤1111!\",Toast.LENGTH_LONG).show();\r\n            }\r\n        });\r\n\r\n        RequestQueue requestQueue= Volley.newRequestQueue(this);\r\n        requestQueue.add(jsonObjectRequest);\r\n    }\r\n\r\n    //標題popupwindow\r\n    public class popupWindow extends PopupWindow implements View.OnClickListener {\r\n        View view;\r\n        EditText mTitle;\r\n        TextView mNext;\r\n\r\n        public popupWindow(Context mContext) {\r\n            //動態頁面載入\r\n            view = LayoutInflater.from(mContext).inflate(R.layout.page5012popupwindow, null);\r\n            mTitle = view.findViewById(R.id.title);\r\n            mNext = view.findViewById(R.id.next);\r\n            //下一步前檢查是否有輸入標題\r\n            mNext.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    TitleRequest(); //檢查標題是否為空\r\n                }\r\n            });\r\n            //設置PopupWindow的View\r\n            this.setContentView(view);\r\n            //設置PopupWindow彈出框的高\r\n            this.setHeight(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置PopupWindow彈出框的寬\r\n            this.setWidth(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置mPopupWindow彈出框可點擊\r\n            this.setFocusable(true);\r\n            //實例化一個ColorDrawable顏色為半透明\r\n            ColorDrawable dw = new ColorDrawable(0xb0000000);\r\n            //設置PopupWindow彈出框的背景\r\n            this.setBackgroundDrawable(dw);\r\n            //設置PopupWindow點框外銷毀\r\n            this.setOutsideTouchable(true);\r\n            view.setOnTouchListener(new View.OnTouchListener() {\r\n                @Override\r\n                public boolean onTouch(View v, MotionEvent motionEvent) {\r\n                    int top=view.findViewById(R.id.img).getTop();\r\n                    int bottom=view.findViewById(R.id.img).getBottom();\r\n                    int left=view.findViewById(R.id.img).getLeft();\r\n                    int right=view.findViewById(R.id.img).getRight();\r\n                    int y=(int)motionEvent.getY();\r\n                    int x=(int)motionEvent.getX();\r\n                    if (motionEvent.getAction()==MotionEvent.ACTION_UP){\r\n                        if (y<top || y>bottom || x<left || x>right)\r\n                            dismiss();\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n        }\r\n        @Override\r\n        public void onClick(View V) {\r\n        }\r\n\r\n        //檢查標題是否為空(如不是:選擇圖片)\r\n        public void TitleRequest(){\r\n            title2=mTitle.getText().toString().trim();\r\n            if (title2.isEmpty()){\r\n                Toast.makeText(Page5012Activity.this, \"請輸入標題\", Toast.LENGTH_LONG).show();\r\n                return;\r\n            }else{  //選擇圖片popupwindow\r\n                //銷毀第一個popupwindow\r\n                dismiss();\r\n                //實例化PopupPhoto\r\n                popupSelPhoto popupPhoto=new popupSelPhoto(Page5012Activity.this);\r\n                View v=LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupphoto,null);\r\n                //設計彈出框\r\n                popupPhoto.showAtLocation(v,Gravity.CENTER,0,0);\r\n            }\r\n        }\r\n    }\r\n\r\n    //標題popupSelPhoto\r\n    public class popupSelPhoto extends PopupWindow implements View.OnClickListener{\r\n        View v;\r\n        ImageView mWork,mHome,mPlay,mShopping,mSaveImg;\r\n        int choose=0;\r\n        String img = \"\";\r\n        public popupSelPhoto(Context mContext2) {\r\n            //動態頁面載入\r\n            v = LayoutInflater.from(mContext2).inflate(R.layout.page5012popupphoto, null);\r\n\r\n            mWork=v.findViewById(R.id.work);\r\n            mHome=v.findViewById(R.id.home);\r\n            mPlay=v.findViewById(R.id.play);\r\n            mShopping=v.findViewById(R.id.shopping);\r\n            mSaveImg=v.findViewById(R.id.saveImg);\r\n\r\n            //設置PopupWindow的View\r\n            this.setContentView(v);\r\n            //設置PopupWindow彈出框的高\r\n            this.setHeight(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置PopupWindow彈出框的寬\r\n            this.setWidth(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置mPopupWindow彈出框可點擊\r\n            this.setFocusable(true);\r\n            //實例化一個ColorDrawable顏色為半透明\r\n            ColorDrawable dw = new ColorDrawable(0xb0000000);\r\n            //設置PopupWindow彈出框的背景\r\n            this.setBackgroundDrawable(dw);\r\n            //設置PopupWindow點框外銷毀\r\n            this.setOutsideTouchable(true);\r\n            v.setOnTouchListener(new View.OnTouchListener() {\r\n                @Override\r\n                public boolean onTouch(View view, MotionEvent motionEvent) {\r\n                    int height=v.findViewById(R.id.selphotobg).getHeight();\r\n                    int y=(int)motionEvent.getY();\r\n                    if (motionEvent.getAction()==MotionEvent.ACTION_UP){\r\n                        if (y<height){\r\n                            dismiss();\r\n                        }\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            mWork.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=1;\r\n                    if (choose==1){\r\n                        mWork.setImageResource(R.drawable.working1);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"work\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mHome.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=2;\r\n                    if (choose==2){\r\n                        mHome.setImageResource(R.drawable.home1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"home\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mPlay.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=3;\r\n                    if (choose==3){\r\n                        mPlay.setImageResource(R.drawable.play1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"play\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mShopping.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=4;\r\n                    if (choose==4){\r\n                        mShopping.setImageResource(R.drawable.shopping1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        img = \"shopping\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mSaveImg.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose+=1;\r\n                    if (choose>=2 && choose<=5){ //有選擇照片\r\n                        System.out.println(choose);\r\n                        dismiss();\r\n                        //將資訊存入資料庫\r\n                        savepic(img);\r\n                        System.out.println(img);\r\n                        Toast.makeText(Page5012Activity.this,\"路線儲存成功！\",Toast.LENGTH_LONG).show();\r\n                    }else{ //沒有選照片\r\n                        Toast.makeText(Page5012Activity.this,\"請選擇圖片！\",Toast.LENGTH_LONG).show();\r\n                    }\r\n                }\r\n            });\r\n\r\n        }\r\n\r\n        @Override\r\n        public void onClick(View view) {\r\n        }\r\n        public void savepic(final String img) {\r\n            String URL = Urls.url1+\"/LoginRegister/savepic.php?email=\"+getmail;\r\n            StringRequest stringRequest = new StringRequest(\r\n                    Request.Method.POST,\r\n                    URL,\r\n                    new Response.Listener<String>() {\r\n                        @Override\r\n                        public void onResponse(String response) {\r\n                            if(response.equals(\"Success\")){\r\n                                finish();\r\n                            }\r\n                        }\r\n                    },\r\n                    new Response.ErrorListener() {\r\n                        @Override\r\n                        public void onErrorResponse(VolleyError error) {\r\n                            Toast.makeText(Page5012Activity.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                        }\r\n                    }\r\n            ) {\r\n                @Nullable\r\n                @Override\r\n                protected Map<String, String> getParams() throws AuthFailureError {\r\n                    Map<String, String> parms = new HashMap<>();\r\n                    parms.put(\"image\",img);\r\n                    return parms;\r\n                }\r\n            };\r\n            requestQueue.add(stringRequest);\r\n        }\r\n    }\r\n\r\n}
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
---- app/src/main/java/com/example/easybus/Page5012Activity.java	(revision 7f13284595a55cd81d97bc3a88986c3b48d495a3)
-+++ app/src/main/java/com/example/easybus/Page5012Activity.java	(date 1628153460996)
-@@ -54,7 +54,7 @@
-     RecyclerView recyclerView;
-     BusInfoAdaptor adaptor;
-     ArrayList<BusInfo> businfos;
--    RequestQueue requestQueue;
-+    RequestQueue requestQueue,requestQueue1;
-     @Override
-     protected void onCreate(Bundle savedInstanceState) {
-         super.onCreate(savedInstanceState);
-@@ -84,6 +84,7 @@
-         SharedPreferences email = getSharedPreferences("email",MODE_PRIVATE);
-         getmail=email.getString("Email","");
-         requestQueue = Volley.newRequestQueue(this);
-+        requestQueue1 = Volley.newRequestQueue(this);
- 
-         mAdd.setOnClickListener(new View.OnClickListener() {
-             @Override
-@@ -215,6 +216,7 @@
-                 return;
-             }else{  //選擇圖片popupwindow
-                 //銷毀第一個popupwindow
-+                savebusinfo(getmail,title2,url);
-                 dismiss();
-                 //實例化PopupPhoto
-                 popupSelPhoto popupPhoto=new popupSelPhoto(Page5012Activity.this);
-@@ -223,6 +225,39 @@
-                 popupPhoto.showAtLocation(v,Gravity.CENTER,0,0);
-             }
-         }
-+
-+        public void savebusinfo(final String email,final String routename,final String route) {
-+            String URL = Urls.url1+"/LoginRegister/save_businfo.php";
-+            StringRequest stringRequest = new StringRequest(
-+                    Request.Method.POST,
-+                    URL,
-+                    new Response.Listener<String>() {
-+                        @Override
-+                        public void onResponse(String response) {
-+                            if(response.equals("Success")){
-+                                finish();
-+                            }
-+                        }
-+                    },
-+                    new Response.ErrorListener() {
-+                        @Override
-+                        public void onErrorResponse(VolleyError error) {
-+                            Toast.makeText(Page5012Activity.this, error.toString(), Toast.LENGTH_SHORT).show();
-+                        }
-+                    }
-+            ) {
-+                @Nullable
-+                @Override
-+                protected Map<String, String> getParams() throws AuthFailureError {
-+                    Map<String, String> parms = new HashMap<>();
-+                    parms.put("email",email);
-+                    parms.put("routename",routename);
-+                    parms.put("route",route);
-+                    return parms;
-+                }
-+            };
-+            requestQueue1.add(stringRequest);
-+        }
-     }
- 
-     //標題popupSelPhoto
Index: .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_6_下午_04_08_[Default_Changelist]/shelved.patch
===================================================================
--- .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_6_下午_04_08_[Default_Changelist]/shelved.patch	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
+++ .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_6_下午_04_08_[Default_Changelist]/shelved.patch	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
@@ -1,139 +0,0 @@
-Index: app/src/main/java/com/example/easybus/Page5012Activity.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>package com.example.easybus;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.ActionBar;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport android.app.ProgressDialog;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.ColorMatrix;\r\nimport android.graphics.ColorMatrixColorFilter;\r\nimport android.graphics.drawable.ColorDrawable;\r\nimport android.os.Bundle;\r\nimport android.util.Base64;\r\nimport android.view.Gravity;\r\nimport android.view.LayoutInflater;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.PopupWindow;\r\nimport android.widget.RelativeLayout;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.android.volley.AuthFailureError;\r\nimport com.android.volley.Request;\r\nimport com.android.volley.RequestQueue;\r\nimport com.android.volley.Response;\r\nimport com.android.volley.VolleyError;\r\nimport com.android.volley.toolbox.JsonObjectRequest;\r\nimport com.android.volley.toolbox.StringRequest;\r\nimport com.android.volley.toolbox.Volley;\r\n\r\nimport org.json.JSONArray;\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\npublic class Page5012Activity extends AppCompatActivity {\r\n    //12345\r\n    private static final String DIRECTION_URL_API = \"https://maps.googleapis.com/maps/api/directions/json?\";\r\n    private static final String GOOGLE_API_KEY = \"AIzaSyCr_-3KbvHxSm9Gb38l7M2E_b8qzwHhcTI\";\r\n    String url,urlOrigin,urlDestination,title2,getmail;\r\n    ImageView mImg,mBack,mAdd;\r\n    RecyclerView recyclerView;\r\n    BusInfoAdaptor adaptor;\r\n    ArrayList<BusInfo> businfos;\r\n    RequestQueue requestQueue,requestQueue1;\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_page5012);\r\n\r\n        //隱藏title bar\r\n        ActionBar actionBar = getSupportActionBar();\r\n        actionBar.hide();\r\n\r\n        //取值(origin,destination)\r\n        Bundle bundle = getIntent().getExtras();\r\n        urlOrigin= bundle.getString(\"origin2\");\r\n        urlDestination= bundle.getString(\"destination2\");\r\n\r\n        url=DIRECTION_URL_API+\"origin=\"+urlOrigin+\"&destination=\"+urlDestination+\"&mode=transit&transit_mode=bus&language=zh-TW&key=\"+GOOGLE_API_KEY;\r\n        System.out.println(url);\r\n        mImg=findViewById(R.id.img);\r\n        mBack=findViewById(R.id.backicon);\r\n        mAdd=findViewById(R.id.addIcon);\r\n        recyclerView=findViewById(R.id.busInfo);\r\n\r\n        recyclerView.setLayoutManager(new LinearLayoutManager(this));\r\n        adaptor=new BusInfoAdaptor();\r\n        recyclerView.setAdapter(adaptor);\r\n        businfos=new ArrayList<>();\r\n        getData();\r\n        SharedPreferences email = getSharedPreferences(\"email\",MODE_PRIVATE);\r\n        getmail=email.getString(\"Email\",\"\");\r\n        requestQueue = Volley.newRequestQueue(this);\r\n        requestQueue1 = Volley.newRequestQueue(this);\r\n\r\n        mAdd.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                //實例化mPopupWindow\r\n                popupWindow popupWin=new popupWindow(Page5012Activity.this);\r\n                View view= LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupwindow,null);\r\n                //設計彈出框\r\n                popupWin.showAtLocation(view,Gravity.CENTER,0,0);\r\n\r\n            }\r\n        });\r\n\r\n        mBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                finish();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void getData() { //抓公車JSON\r\n        final ProgressDialog progressDialog=new ProgressDialog(this);\r\n        progressDialog.setMessage(\"載入中...\");\r\n        progressDialog.show();\r\n\r\n        final JsonObjectRequest jsonObjectRequest=new JsonObjectRequest(url,null, new Response.Listener<JSONObject>() {\r\n            @Override\r\n            public void onResponse(JSONObject response) {\r\n                try{\r\n                    JSONArray ArrayRoutes = response.getJSONArray(\"routes\");\r\n                    JSONArray ArrayLegs =ArrayRoutes.getJSONObject(0).getJSONArray(\"legs\");\r\n                    JSONArray ArraySteps =ArrayLegs.getJSONObject(0).getJSONArray(\"steps\");\r\n\r\n                    for(int i=0;i<ArraySteps.length();i++){\r\n                        JSONObject ObjSteps=ArraySteps.getJSONObject(i);\r\n                        String travelMode=ObjSteps.getString(\"travel_mode\");\r\n                        BusInfo businfo=new BusInfo();\r\n\r\n                        if (travelMode.equals(\"WALKING\")) {\r\n                            String Htmlinstructions=ObjSteps.getString(\"html_instructions\");\r\n                            businfo.setHtmlinstructions(Htmlinstructions.substring(3));\r\n                            businfo.setShortname(null);\r\n                            businfo.setPic(1);\r\n                        }else{\r\n                            businfo.setHtmlinstructions (ObjSteps.getJSONObject(\"transit_details\").getJSONObject(\"arrival_stop\").getString(\"name\"));\r\n                            businfo.setShortname(ObjSteps.getJSONObject(\"transit_details\").getJSONObject(\"line\").getString(\"short_name\"));\r\n                            businfo.setPic(0);\r\n                        }\r\n                        businfos.add(businfo);\r\n                    }\r\n                }catch (JSONException e){\r\n                    Toast.makeText(Page5012Activity.this,e.getMessage()+\"錯誤1\",Toast.LENGTH_LONG).show();\r\n                }\r\n                adaptor.setData(businfos);\r\n                adaptor.notifyDataSetChanged();\r\n                progressDialog.dismiss();\r\n            }\r\n        }, new Response.ErrorListener() {\r\n            @Override\r\n            public void onErrorResponse(VolleyError error) {\r\n                progressDialog.dismiss();\r\n                Toast.makeText(Page5012Activity.this,\"發生錯誤1111!\",Toast.LENGTH_LONG).show();\r\n            }\r\n        });\r\n\r\n        RequestQueue requestQueue= Volley.newRequestQueue(this);\r\n        requestQueue.add(jsonObjectRequest);\r\n    }\r\n\r\n    //標題popupwindow\r\n    public class popupWindow extends PopupWindow implements View.OnClickListener {\r\n        View view;\r\n        EditText mTitle;\r\n        TextView mNext;\r\n\r\n        public popupWindow(Context mContext) {\r\n            //動態頁面載入\r\n            view = LayoutInflater.from(mContext).inflate(R.layout.page5012popupwindow, null);\r\n            mTitle = view.findViewById(R.id.title);\r\n            mNext = view.findViewById(R.id.next);\r\n            //下一步前檢查是否有輸入標題\r\n            mNext.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    TitleRequest(); //檢查標題是否為空\r\n                }\r\n            });\r\n            //設置PopupWindow的View\r\n            this.setContentView(view);\r\n            //設置PopupWindow彈出框的高\r\n            this.setHeight(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置PopupWindow彈出框的寬\r\n            this.setWidth(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置mPopupWindow彈出框可點擊\r\n            this.setFocusable(true);\r\n            //實例化一個ColorDrawable顏色為半透明\r\n            ColorDrawable dw = new ColorDrawable(0xb0000000);\r\n            //設置PopupWindow彈出框的背景\r\n            this.setBackgroundDrawable(dw);\r\n            //設置PopupWindow點框外銷毀\r\n            this.setOutsideTouchable(true);\r\n            view.setOnTouchListener(new View.OnTouchListener() {\r\n                @Override\r\n                public boolean onTouch(View v, MotionEvent motionEvent) {\r\n                    int top=view.findViewById(R.id.img).getTop();\r\n                    int bottom=view.findViewById(R.id.img).getBottom();\r\n                    int left=view.findViewById(R.id.img).getLeft();\r\n                    int right=view.findViewById(R.id.img).getRight();\r\n                    int y=(int)motionEvent.getY();\r\n                    int x=(int)motionEvent.getX();\r\n                    if (motionEvent.getAction()==MotionEvent.ACTION_UP){\r\n                        if (y<top || y>bottom || x<left || x>right)\r\n                            dismiss();\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n        }\r\n        @Override\r\n        public void onClick(View V) {\r\n        }\r\n\r\n        //檢查標題是否為空(如不是:選擇圖片)\r\n        public void TitleRequest(){\r\n            title2=mTitle.getText().toString().trim();\r\n            if (title2.isEmpty()){\r\n                Toast.makeText(Page5012Activity.this, \"請輸入標題\", Toast.LENGTH_LONG).show();\r\n                return;\r\n            }else{  //選擇圖片popupwindow\r\n                //銷毀第一個popupwindow\r\n                savebusinfo(getmail,title2,url);\r\n                dismiss();\r\n                //實例化PopupPhoto\r\n                popupSelPhoto popupPhoto=new popupSelPhoto(Page5012Activity.this);\r\n                View v=LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupphoto,null);\r\n                //設計彈出框\r\n                popupPhoto.showAtLocation(v,Gravity.CENTER,0,0);\r\n            }\r\n        }\r\n\r\n        public void savebusinfo(final String email,final String routename,final String route) {\r\n            String URL = Urls.url1+\"/LoginRegister/save_businfo.php\";\r\n            StringRequest stringRequest = new StringRequest(\r\n                    Request.Method.POST,\r\n                    URL,\r\n                    new Response.Listener<String>() {\r\n                        @Override\r\n                        public void onResponse(String response) {\r\n                            if(response.equals(\"Success\")){\r\n                                finish();\r\n                            }\r\n                        }\r\n                    },\r\n                    new Response.ErrorListener() {\r\n                        @Override\r\n                        public void onErrorResponse(VolleyError error) {\r\n                            Toast.makeText(Page5012Activity.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                        }\r\n                    }\r\n            ) {\r\n                @Nullable\r\n                @Override\r\n                protected Map<String, String> getParams() throws AuthFailureError {\r\n                    Map<String, String> parms = new HashMap<>();\r\n                    parms.put(\"email\",email);\r\n                    parms.put(\"routename\",routename);\r\n                    parms.put(\"route\",route);\r\n                    return parms;\r\n                }\r\n            };\r\n            requestQueue1.add(stringRequest);\r\n        }\r\n    }\r\n\r\n    //標題popupSelPhoto\r\n    public class popupSelPhoto extends PopupWindow implements View.OnClickListener{\r\n        View v;\r\n        ImageView mWork,mHome,mPlay,mShopping,mSaveImg;\r\n        int choose=0;\r\n        String img = \"\";\r\n        public popupSelPhoto(Context mContext2) {\r\n            //動態頁面載入\r\n            v = LayoutInflater.from(mContext2).inflate(R.layout.page5012popupphoto, null);\r\n\r\n            mWork=v.findViewById(R.id.work);\r\n            mHome=v.findViewById(R.id.home);\r\n            mPlay=v.findViewById(R.id.play);\r\n            mShopping=v.findViewById(R.id.shopping);\r\n            mSaveImg=v.findViewById(R.id.saveImg);\r\n\r\n            //設置PopupWindow的View\r\n            this.setContentView(v);\r\n            //設置PopupWindow彈出框的高\r\n            this.setHeight(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置PopupWindow彈出框的寬\r\n            this.setWidth(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置mPopupWindow彈出框可點擊\r\n            this.setFocusable(true);\r\n            //實例化一個ColorDrawable顏色為半透明\r\n            ColorDrawable dw = new ColorDrawable(0xb0000000);\r\n            //設置PopupWindow彈出框的背景\r\n            this.setBackgroundDrawable(dw);\r\n            //設置PopupWindow點框外銷毀\r\n            this.setOutsideTouchable(true);\r\n            v.setOnTouchListener(new View.OnTouchListener() {\r\n                @Override\r\n                public boolean onTouch(View view, MotionEvent motionEvent) {\r\n                    int height=v.findViewById(R.id.selphotobg).getHeight();\r\n                    int y=(int)motionEvent.getY();\r\n                    if (motionEvent.getAction()==MotionEvent.ACTION_UP){\r\n                        if (y<height){\r\n                            dismiss();\r\n                        }\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            mWork.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=1;\r\n                    if (choose==1){\r\n                        mWork.setImageResource(R.drawable.working1);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"work\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mHome.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=2;\r\n                    if (choose==2){\r\n                        mHome.setImageResource(R.drawable.home1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"home\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mPlay.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=3;\r\n                    if (choose==3){\r\n                        mPlay.setImageResource(R.drawable.play1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"play\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mShopping.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=4;\r\n                    if (choose==4){\r\n                        mShopping.setImageResource(R.drawable.shopping1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        img = \"shopping\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mSaveImg.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose+=1;\r\n                    if (choose>=2 && choose<=5){ //有選擇照片\r\n                        System.out.println(choose);\r\n                        dismiss();\r\n                        //將資訊存入資料庫\r\n                        savepic(img);\r\n                        System.out.println(img);\r\n                        Toast.makeText(Page5012Activity.this,\"路線儲存成功！\",Toast.LENGTH_LONG).show();\r\n                    }else{ //沒有選照片\r\n                        Toast.makeText(Page5012Activity.this,\"請選擇圖片！\",Toast.LENGTH_LONG).show();\r\n                    }\r\n                }\r\n            });\r\n\r\n        }\r\n\r\n        @Override\r\n        public void onClick(View view) {\r\n        }\r\n        public void savepic(final String img) {\r\n            String URL = Urls.url1+\"/LoginRegister/savepic.php?email=\"+getmail;\r\n            StringRequest stringRequest = new StringRequest(\r\n                    Request.Method.POST,\r\n                    URL,\r\n                    new Response.Listener<String>() {\r\n                        @Override\r\n                        public void onResponse(String response) {\r\n                            if(response.equals(\"Success\")){\r\n                                finish();\r\n                            }\r\n                        }\r\n                    },\r\n                    new Response.ErrorListener() {\r\n                        @Override\r\n                        public void onErrorResponse(VolleyError error) {\r\n                            Toast.makeText(Page5012Activity.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                        }\r\n                    }\r\n            ) {\r\n                @Nullable\r\n                @Override\r\n                protected Map<String, String> getParams() throws AuthFailureError {\r\n                    Map<String, String> parms = new HashMap<>();\r\n                    parms.put(\"image\",img);\r\n                    return parms;\r\n                }\r\n            };\r\n            requestQueue.add(stringRequest);\r\n        }\r\n    }\r\n\r\n}
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
---- app/src/main/java/com/example/easybus/Page5012Activity.java	(revision e3f3d62adc5dd6d511ee22fd4c5038264c767fde)
-+++ app/src/main/java/com/example/easybus/Page5012Activity.java	(date 1628236941761)
-@@ -70,7 +70,7 @@
-         urlDestination= bundle.getString("destination2");
- 
-         url=DIRECTION_URL_API+"origin="+urlOrigin+"&destination="+urlDestination+"&mode=transit&transit_mode=bus&language=zh-TW&key="+GOOGLE_API_KEY;
--        System.out.println(url);
-+
-         mImg=findViewById(R.id.img);
-         mBack=findViewById(R.id.backicon);
-         mAdd=findViewById(R.id.addIcon);
-@@ -216,48 +216,19 @@
-                 return;
-             }else{  //選擇圖片popupwindow
-                 //銷毀第一個popupwindow
--                savebusinfo(getmail,title2,url);
-+
-                 dismiss();
-                 //實例化PopupPhoto
-                 popupSelPhoto popupPhoto=new popupSelPhoto(Page5012Activity.this);
-                 View v=LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupphoto,null);
-                 //設計彈出框
-                 popupPhoto.showAtLocation(v,Gravity.CENTER,0,0);
-+                //title2=popupPhoto.title;
-+                popupPhoto.title=title2;
-             }
-         }
- 
--        public void savebusinfo(final String email,final String routename,final String route) {
--            String URL = Urls.url1+"/LoginRegister/save_businfo.php";
--            StringRequest stringRequest = new StringRequest(
--                    Request.Method.POST,
--                    URL,
--                    new Response.Listener<String>() {
--                        @Override
--                        public void onResponse(String response) {
--                            if(response.equals("Success")){
--                                finish();
--                            }
--                        }
--                    },
--                    new Response.ErrorListener() {
--                        @Override
--                        public void onErrorResponse(VolleyError error) {
--                            Toast.makeText(Page5012Activity.this, error.toString(), Toast.LENGTH_SHORT).show();
--                        }
--                    }
--            ) {
--                @Nullable
--                @Override
--                protected Map<String, String> getParams() throws AuthFailureError {
--                    Map<String, String> parms = new HashMap<>();
--                    parms.put("email",email);
--                    parms.put("routename",routename);
--                    parms.put("route",route);
--                    return parms;
--                }
--            };
--            requestQueue1.add(stringRequest);
--        }
-+
-     }
- 
-     //標題popupSelPhoto
-@@ -265,7 +236,7 @@
-         View v;
-         ImageView mWork,mHome,mPlay,mShopping,mSaveImg;
-         int choose=0;
--        String img = "";
-+        String title,img = "";
-         public popupSelPhoto(Context mContext2) {
-             //動態頁面載入
-             v = LayoutInflater.from(mContext2).inflate(R.layout.page5012popupphoto, null);
-@@ -366,9 +337,12 @@
-                     choose+=1;
-                     if (choose>=2 && choose<=5){ //有選擇照片
-                         System.out.println(choose);
-+                        System.out.println("title : "+title);
-+                        System.out.println(url);
-                         dismiss();
-                         //將資訊存入資料庫
--                        savepic(img);
-+                        savebusinfo(getmail,title,url,img);
-+
-                         System.out.println(img);
-                         Toast.makeText(Page5012Activity.this,"路線儲存成功！",Toast.LENGTH_LONG).show();
-                     }else{ //沒有選照片
-@@ -382,8 +356,8 @@
-         @Override
-         public void onClick(View view) {
-         }
--        public void savepic(final String img) {
--            String URL = Urls.url1+"/LoginRegister/savepic.php?email="+getmail;
-+        public void savebusinfo(final String email,final String routename,final String route,final String img) {
-+            String URL = Urls.url1+"/LoginRegister/save_businfo.php";
-             StringRequest stringRequest = new StringRequest(
-                     Request.Method.POST,
-                     URL,
-@@ -406,11 +380,14 @@
-                 @Override
-                 protected Map<String, String> getParams() throws AuthFailureError {
-                     Map<String, String> parms = new HashMap<>();
-+                    parms.put("email",email);
-+                    parms.put("routename",routename);
-+                    parms.put("route",route);
-                     parms.put("image",img);
-                     return parms;
-                 }
-             };
--            requestQueue.add(stringRequest);
-+            requestQueue1.add(stringRequest);
-         }
-     }
- 
-Index: app/src/main/java/com/example/easybus/Urls.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>package com.example.easybus;\r\nimport java.net.InetAddress;\r\nimport java.net.UnknownHostException;\r\n\r\npublic class Urls {\r\n    //private static InetAddress ip;/////\r\n    public static String url1 = \"http://192.168.137.1\";\r\n    //public static String url1 = \"http://8c708b26959c.ngrok.io\";\r\n    public static void main(String args[]) {\r\n\r\n        /*try {\r\n            ip = InetAddress.getLocalHost();\r\n            System.out.println(ip.getHostAddress());\r\n        } catch (UnknownHostException e) {\r\n            e.printStackTrace();\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n        }*/\r\n\r\n\r\n\r\n    }\r\n    //static String ROOT_URL = url1+url2+url3;\r\n    //static String FORGOT_PASSWORD_URL = \"http://192.168.27.107/LoginRegister/\" + \"forgot.php\";\r\n//搞不清楚 你不是說要用appple 對阿 可是不能merge 現在又說EasyBus 有問題\r\n\r\n}
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
---- app/src/main/java/com/example/easybus/Urls.java	(revision e3f3d62adc5dd6d511ee22fd4c5038264c767fde)
-+++ app/src/main/java/com/example/easybus/Urls.java	(date 1628236198824)
-@@ -4,7 +4,7 @@
- 
- public class Urls {
-     //private static InetAddress ip;/////
--    public static String url1 = "http://192.168.137.1";
-+    public static String url1 = "http://192.168.0.126";
-     //public static String url1 = "http://8c708b26959c.ngrok.io";
-     public static void main(String args[]) {
- 
Index: .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_5__04_50__Default_Changelist_.xml
===================================================================
--- .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_5__04_50__Default_Changelist_.xml	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
+++ .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_5__04_50__Default_Changelist_.xml	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
@@ -1,9 +0,0 @@
-<changelist name="Uncommitted_changes_before_Checkout_at_2021_8_5_下午_04_50_[Default_Changelist]" date="1628153461317" recycled="true" deleted="true">
-  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_5_下午_04_50_[Default_Changelist]/shelved.patch" />
-  <option name="DESCRIPTION" value="Uncommitted changes before Checkout at 2021/8/5 下午 04:50 [Default Changelist]" />
-  <binary>
-    <option name="BEFORE_PATH" />
-    <option name="AFTER_PATH" value="app/src/main/res/drawable/waitingbus.jpg" />
-    <option name="SHELVED_PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_5_下午_04_50_[Default_Changelist]/waitingbus.jpg" />
-  </binary>
-</changelist>
\ No newline at end of file
Index: .idea/shelf/Uncommitted_changes_before_Merge_at_2021_8_5__04_51__Default_Changelist_.xml
===================================================================
--- .idea/shelf/Uncommitted_changes_before_Merge_at_2021_8_5__04_51__Default_Changelist_.xml	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
+++ .idea/shelf/Uncommitted_changes_before_Merge_at_2021_8_5__04_51__Default_Changelist_.xml	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
@@ -1,9 +0,0 @@
-<changelist name="Uncommitted_changes_before_Merge_at_2021_8_5_下午_04_51_[Default_Changelist]" date="1628153490582" recycled="true" deleted="true">
-  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_2021_8_5_下午_04_51_[Default_Changelist]/shelved.patch" />
-  <option name="DESCRIPTION" value="Uncommitted changes before Merge at 2021/8/5 下午 04:51 [Default Changelist]" />
-  <binary>
-    <option name="BEFORE_PATH" />
-    <option name="AFTER_PATH" value="app/src/main/res/drawable/waitingbus.jpg" />
-    <option name="SHELVED_PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_2021_8_5_下午_04_51_[Default_Changelist]/waitingbus.jpg" />
-  </binary>
-</changelist>
\ No newline at end of file
Index: .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_6__04_08__Default_Changelist_.xml
===================================================================
--- .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_6__04_08__Default_Changelist_.xml	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
+++ .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_6__04_08__Default_Changelist_.xml	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
@@ -1,4 +0,0 @@
-<changelist name="Uncommitted_changes_before_Checkout_at_2021_8_6_下午_04_08_[Default_Changelist]" date="1628237362581" recycled="true" deleted="true">
-  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_6_下午_04_08_[Default_Changelist]/shelved.patch" />
-  <option name="DESCRIPTION" value="Uncommitted changes before Checkout at 2021/8/6 下午 04:08 [Default Changelist]" />
-</changelist>
\ No newline at end of file
Index: .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_5_下午_04_50_[Default_Changelist]/shelved.patch
===================================================================
--- .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_5_下午_04_50_[Default_Changelist]/shelved.patch	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
+++ .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_5_下午_04_50_[Default_Changelist]/shelved.patch	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
@@ -1,76 +0,0 @@
-Index: app/src/main/java/com/example/easybus/Page5012Activity.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>package com.example.easybus;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.ActionBar;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport android.app.ProgressDialog;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.ColorMatrix;\r\nimport android.graphics.ColorMatrixColorFilter;\r\nimport android.graphics.drawable.ColorDrawable;\r\nimport android.os.Bundle;\r\nimport android.util.Base64;\r\nimport android.view.Gravity;\r\nimport android.view.LayoutInflater;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.PopupWindow;\r\nimport android.widget.RelativeLayout;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.android.volley.AuthFailureError;\r\nimport com.android.volley.Request;\r\nimport com.android.volley.RequestQueue;\r\nimport com.android.volley.Response;\r\nimport com.android.volley.VolleyError;\r\nimport com.android.volley.toolbox.JsonObjectRequest;\r\nimport com.android.volley.toolbox.StringRequest;\r\nimport com.android.volley.toolbox.Volley;\r\n\r\nimport org.json.JSONArray;\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\npublic class Page5012Activity extends AppCompatActivity {\r\n\r\n    private static final String DIRECTION_URL_API = \"https://maps.googleapis.com/maps/api/directions/json?\";\r\n    private static final String GOOGLE_API_KEY = \"AIzaSyCr_-3KbvHxSm9Gb38l7M2E_b8qzwHhcTI\";\r\n    String url,urlOrigin,urlDestination,title2,getmail;\r\n    ImageView mImg,mBack,mAdd;\r\n    RecyclerView recyclerView;\r\n    BusInfoAdaptor adaptor;\r\n    ArrayList<BusInfo> businfos;\r\n    RequestQueue requestQueue;\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_page5012);\r\n\r\n        //隱藏title bar\r\n        ActionBar actionBar = getSupportActionBar();\r\n        actionBar.hide();\r\n\r\n        //取值(origin,destination)\r\n        Bundle bundle = getIntent().getExtras();\r\n        urlOrigin= bundle.getString(\"origin2\");\r\n        urlDestination= bundle.getString(\"destination2\");\r\n\r\n        url=DIRECTION_URL_API+\"origin=\"+urlOrigin+\"&destination=\"+urlDestination+\"&mode=transit&transit_mode=bus&language=zh-TW&key=\"+GOOGLE_API_KEY;\r\n        System.out.println(url);\r\n        mImg=findViewById(R.id.img);\r\n        mBack=findViewById(R.id.backicon);\r\n        mAdd=findViewById(R.id.addIcon);\r\n        recyclerView=findViewById(R.id.busInfo);\r\n\r\n        recyclerView.setLayoutManager(new LinearLayoutManager(this));\r\n        adaptor=new BusInfoAdaptor();\r\n        recyclerView.setAdapter(adaptor);\r\n        businfos=new ArrayList<>();\r\n        getData();\r\n        SharedPreferences email = getSharedPreferences(\"email\",MODE_PRIVATE);\r\n        getmail=email.getString(\"Email\",\"\");\r\n        requestQueue = Volley.newRequestQueue(this);\r\n\r\n        mAdd.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                //實例化mPopupWindow\r\n                popupWindow popupWin=new popupWindow(Page5012Activity.this);\r\n                View view= LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupwindow,null);\r\n                //設計彈出框\r\n                popupWin.showAtLocation(view,Gravity.CENTER,0,0);\r\n\r\n            }\r\n        });\r\n\r\n        mBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                finish();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void getData() { //抓公車JSON\r\n        final ProgressDialog progressDialog=new ProgressDialog(this);\r\n        progressDialog.setMessage(\"載入中...\");\r\n        progressDialog.show();\r\n\r\n        final JsonObjectRequest jsonObjectRequest=new JsonObjectRequest(url,null, new Response.Listener<JSONObject>() {\r\n            @Override\r\n            public void onResponse(JSONObject response) {\r\n                try{\r\n                    JSONArray ArrayRoutes = response.getJSONArray(\"routes\");\r\n                    JSONArray ArrayLegs =ArrayRoutes.getJSONObject(0).getJSONArray(\"legs\");\r\n                    JSONArray ArraySteps =ArrayLegs.getJSONObject(0).getJSONArray(\"steps\");\r\n\r\n                    for(int i=0;i<ArraySteps.length();i++){\r\n                        JSONObject ObjSteps=ArraySteps.getJSONObject(i);\r\n                        String travelMode=ObjSteps.getString(\"travel_mode\");\r\n                        BusInfo businfo=new BusInfo();\r\n\r\n                        if (travelMode.equals(\"WALKING\")) {\r\n                            String Htmlinstructions=ObjSteps.getString(\"html_instructions\");\r\n                            businfo.setHtmlinstructions(Htmlinstructions.substring(3));\r\n                            businfo.setShortname(null);\r\n                            businfo.setPic(1);\r\n                        }else{\r\n                            businfo.setHtmlinstructions (ObjSteps.getJSONObject(\"transit_details\").getJSONObject(\"arrival_stop\").getString(\"name\"));\r\n                            businfo.setShortname(ObjSteps.getJSONObject(\"transit_details\").getJSONObject(\"line\").getString(\"short_name\"));\r\n                            businfo.setPic(0);\r\n                        }\r\n                        businfos.add(businfo);\r\n                    }\r\n                }catch (JSONException e){\r\n                    Toast.makeText(Page5012Activity.this,e.getMessage()+\"錯誤1\",Toast.LENGTH_LONG).show();\r\n                }\r\n                adaptor.setData(businfos);\r\n                adaptor.notifyDataSetChanged();\r\n                progressDialog.dismiss();\r\n            }\r\n        }, new Response.ErrorListener() {\r\n            @Override\r\n            public void onErrorResponse(VolleyError error) {\r\n                progressDialog.dismiss();\r\n                Toast.makeText(Page5012Activity.this,\"發生錯誤1111!\",Toast.LENGTH_LONG).show();\r\n            }\r\n        });\r\n\r\n        RequestQueue requestQueue= Volley.newRequestQueue(this);\r\n        requestQueue.add(jsonObjectRequest);\r\n    }\r\n\r\n    //標題popupwindow\r\n    public class popupWindow extends PopupWindow implements View.OnClickListener {\r\n        View view;\r\n        EditText mTitle;\r\n        TextView mNext;\r\n\r\n        public popupWindow(Context mContext) {\r\n            //動態頁面載入\r\n            view = LayoutInflater.from(mContext).inflate(R.layout.page5012popupwindow, null);\r\n            mTitle = view.findViewById(R.id.title);\r\n            mNext = view.findViewById(R.id.next);\r\n            //下一步前檢查是否有輸入標題\r\n            mNext.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    TitleRequest(); //檢查標題是否為空\r\n                }\r\n            });\r\n            //設置PopupWindow的View\r\n            this.setContentView(view);\r\n            //設置PopupWindow彈出框的高\r\n            this.setHeight(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置PopupWindow彈出框的寬\r\n            this.setWidth(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置mPopupWindow彈出框可點擊\r\n            this.setFocusable(true);\r\n            //實例化一個ColorDrawable顏色為半透明\r\n            ColorDrawable dw = new ColorDrawable(0xb0000000);\r\n            //設置PopupWindow彈出框的背景\r\n            this.setBackgroundDrawable(dw);\r\n            //設置PopupWindow點框外銷毀\r\n            this.setOutsideTouchable(true);\r\n            view.setOnTouchListener(new View.OnTouchListener() {\r\n                @Override\r\n                public boolean onTouch(View v, MotionEvent motionEvent) {\r\n                    int top=view.findViewById(R.id.img).getTop();\r\n                    int bottom=view.findViewById(R.id.img).getBottom();\r\n                    int left=view.findViewById(R.id.img).getLeft();\r\n                    int right=view.findViewById(R.id.img).getRight();\r\n                    int y=(int)motionEvent.getY();\r\n                    int x=(int)motionEvent.getX();\r\n                    if (motionEvent.getAction()==MotionEvent.ACTION_UP){\r\n                        if (y<top || y>bottom || x<left || x>right)\r\n                            dismiss();\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n        }\r\n        @Override\r\n        public void onClick(View V) {\r\n        }\r\n\r\n        //檢查標題是否為空(如不是:選擇圖片)\r\n        public void TitleRequest(){\r\n            title2=mTitle.getText().toString().trim();\r\n            if (title2.isEmpty()){\r\n                Toast.makeText(Page5012Activity.this, \"請輸入標題\", Toast.LENGTH_LONG).show();\r\n                return;\r\n            }else{  //選擇圖片popupwindow\r\n                //銷毀第一個popupwindow\r\n                dismiss();\r\n                //實例化PopupPhoto\r\n                popupSelPhoto popupPhoto=new popupSelPhoto(Page5012Activity.this);\r\n                View v=LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupphoto,null);\r\n                //設計彈出框\r\n                popupPhoto.showAtLocation(v,Gravity.CENTER,0,0);\r\n            }\r\n        }\r\n    }\r\n\r\n    //標題popupSelPhoto\r\n    public class popupSelPhoto extends PopupWindow implements View.OnClickListener{\r\n        View v;\r\n        ImageView mWork,mHome,mPlay,mShopping,mSaveImg;\r\n        int choose=0;\r\n        String img = \"\";\r\n        public popupSelPhoto(Context mContext2) {\r\n            //動態頁面載入\r\n            v = LayoutInflater.from(mContext2).inflate(R.layout.page5012popupphoto, null);\r\n\r\n            mWork=v.findViewById(R.id.work);\r\n            mHome=v.findViewById(R.id.home);\r\n            mPlay=v.findViewById(R.id.play);\r\n            mShopping=v.findViewById(R.id.shopping);\r\n            mSaveImg=v.findViewById(R.id.saveImg);\r\n\r\n            //設置PopupWindow的View\r\n            this.setContentView(v);\r\n            //設置PopupWindow彈出框的高\r\n            this.setHeight(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置PopupWindow彈出框的寬\r\n            this.setWidth(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置mPopupWindow彈出框可點擊\r\n            this.setFocusable(true);\r\n            //實例化一個ColorDrawable顏色為半透明\r\n            ColorDrawable dw = new ColorDrawable(0xb0000000);\r\n            //設置PopupWindow彈出框的背景\r\n            this.setBackgroundDrawable(dw);\r\n            //設置PopupWindow點框外銷毀\r\n            this.setOutsideTouchable(true);\r\n            v.setOnTouchListener(new View.OnTouchListener() {\r\n                @Override\r\n                public boolean onTouch(View view, MotionEvent motionEvent) {\r\n                    int height=v.findViewById(R.id.selphotobg).getHeight();\r\n                    int y=(int)motionEvent.getY();\r\n                    if (motionEvent.getAction()==MotionEvent.ACTION_UP){\r\n                        if (y<height){\r\n                            dismiss();\r\n                        }\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            mWork.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=1;\r\n                    if (choose==1){\r\n                        mWork.setImageResource(R.drawable.working1);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"work\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mHome.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=2;\r\n                    if (choose==2){\r\n                        mHome.setImageResource(R.drawable.home1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"home\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mPlay.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=3;\r\n                    if (choose==3){\r\n                        mPlay.setImageResource(R.drawable.play1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"play\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mShopping.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=4;\r\n                    if (choose==4){\r\n                        mShopping.setImageResource(R.drawable.shopping1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        img = \"shopping\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mSaveImg.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose+=1;\r\n                    if (choose>=2 && choose<=5){ //有選擇照片\r\n                        System.out.println(choose);\r\n                        dismiss();\r\n                        //將資訊存入資料庫\r\n                        savepic(img);\r\n                        System.out.println(img);\r\n                        Toast.makeText(Page5012Activity.this,\"路線儲存成功！\",Toast.LENGTH_LONG).show();\r\n                    }else{ //沒有選照片\r\n                        Toast.makeText(Page5012Activity.this,\"請選擇圖片！\",Toast.LENGTH_LONG).show();\r\n                    }\r\n                }\r\n            });\r\n\r\n        }\r\n\r\n        @Override\r\n        public void onClick(View view) {\r\n        }\r\n        public void savepic(final String img) {\r\n            String URL = Urls.url1+\"/LoginRegister/savepic.php?email=\"+getmail;\r\n            StringRequest stringRequest = new StringRequest(\r\n                    Request.Method.POST,\r\n                    URL,\r\n                    new Response.Listener<String>() {\r\n                        @Override\r\n                        public void onResponse(String response) {\r\n                            if(response.equals(\"Success\")){\r\n                                finish();\r\n                            }\r\n                        }\r\n                    },\r\n                    new Response.ErrorListener() {\r\n                        @Override\r\n                        public void onErrorResponse(VolleyError error) {\r\n                            Toast.makeText(Page5012Activity.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                        }\r\n                    }\r\n            ) {\r\n                @Nullable\r\n                @Override\r\n                protected Map<String, String> getParams() throws AuthFailureError {\r\n                    Map<String, String> parms = new HashMap<>();\r\n                    parms.put(\"image\",img);\r\n                    return parms;\r\n                }\r\n            };\r\n            requestQueue.add(stringRequest);\r\n        }\r\n    }\r\n\r\n}
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
---- app/src/main/java/com/example/easybus/Page5012Activity.java	(revision b8bf1b69abde808772537077f624cbf0e9e5fe52)
-+++ app/src/main/java/com/example/easybus/Page5012Activity.java	(date 1628153456287)
-@@ -54,7 +54,7 @@
-     RecyclerView recyclerView;
-     BusInfoAdaptor adaptor;
-     ArrayList<BusInfo> businfos;
--    RequestQueue requestQueue;
-+    RequestQueue requestQueue,requestQueue1;
-     @Override
-     protected void onCreate(Bundle savedInstanceState) {
-         super.onCreate(savedInstanceState);
-@@ -84,6 +84,7 @@
-         SharedPreferences email = getSharedPreferences("email",MODE_PRIVATE);
-         getmail=email.getString("Email","");
-         requestQueue = Volley.newRequestQueue(this);
-+        requestQueue1 = Volley.newRequestQueue(this);
- 
-         mAdd.setOnClickListener(new View.OnClickListener() {
-             @Override
-@@ -215,6 +216,7 @@
-                 return;
-             }else{  //選擇圖片popupwindow
-                 //銷毀第一個popupwindow
-+                savebusinfo(getmail,title2,url);
-                 dismiss();
-                 //實例化PopupPhoto
-                 popupSelPhoto popupPhoto=new popupSelPhoto(Page5012Activity.this);
-@@ -223,6 +225,39 @@
-                 popupPhoto.showAtLocation(v,Gravity.CENTER,0,0);
-             }
-         }
-+
-+        public void savebusinfo(final String email,final String routename,final String route) {
-+            String URL = Urls.url1+"/LoginRegister/save_businfo.php";
-+            StringRequest stringRequest = new StringRequest(
-+                    Request.Method.POST,
-+                    URL,
-+                    new Response.Listener<String>() {
-+                        @Override
-+                        public void onResponse(String response) {
-+                            if(response.equals("Success")){
-+                                finish();
-+                            }
-+                        }
-+                    },
-+                    new Response.ErrorListener() {
-+                        @Override
-+                        public void onErrorResponse(VolleyError error) {
-+                            Toast.makeText(Page5012Activity.this, error.toString(), Toast.LENGTH_SHORT).show();
-+                        }
-+                    }
-+            ) {
-+                @Nullable
-+                @Override
-+                protected Map<String, String> getParams() throws AuthFailureError {
-+                    Map<String, String> parms = new HashMap<>();
-+                    parms.put("email",email);
-+                    parms.put("routename",routename);
-+                    parms.put("route",route);
-+                    return parms;
-+                }
-+            };
-+            requestQueue1.add(stringRequest);
-+        }
-     }
- 
-     //標題popupSelPhoto
-diff --git .idea/shelf/Uncommitted_changes_before_Merge_at_2021_8_4__02_20__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Merge_at_2021_8_4__02_20__Default_Changelist_.xml
-diff --git .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_4__02_19__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Checkout_at_2021_8_4__02_19__Default_Changelist_.xml
Index: app/src/main/res/layout/cross_dialog.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/cross_dialog.xml	(date 1629099447199)
+++ app/src/main/res/layout/cross_dialog.xml	(date 1629099447199)
@@ -0,0 +1,52 @@
+<?xml version="1.0" encoding="utf-8"?>
+<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    xmlns:tools="http://schemas.android.com/tools"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <ImageView
+        android:id="@+id/imageView10"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        app:layout_constraintBottom_toBottomOf="parent"
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintTop_toTopOf="parent"
+        app:srcCompat="@drawable/cross_background" />
+
+    <ImageView
+        android:id="@+id/backbtn"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        app:layout_constraintBottom_toBottomOf="parent"
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintTop_toTopOf="parent"
+        app:layout_constraintVertical_bias="0.736"
+        app:srcCompat="@drawable/backbtn" />
+
+    <TextView
+        android:id="@+id/content_txt"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:text="TextView"
+        app:layout_constraintBottom_toBottomOf="parent"
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintHorizontal_bias="0.498"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintTop_toTopOf="parent"
+        app:layout_constraintVertical_bias="0.404" />
+
+    <TextView
+        android:id="@+id/back_txt"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:text="TextView"
+        app:layout_constraintBottom_toBottomOf="parent"
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintHorizontal_bias="0.498"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintTop_toTopOf="parent"
+        app:layout_constraintVertical_bias="0.726" />
+</androidx.constraintlayout.widget.ConstraintLayout>
\ No newline at end of file
Index: app/src/main/res/layout/correct_dialog.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/correct_dialog.xml	(date 1629099447194)
+++ app/src/main/res/layout/correct_dialog.xml	(date 1629099447194)
@@ -0,0 +1,52 @@
+<?xml version="1.0" encoding="utf-8"?>
+<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    xmlns:tools="http://schemas.android.com/tools"
+    android:layout_width="match_parent"
+             android:layout_height="match_parent">
+
+    <ImageView
+        android:id="@+id/imageView10"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        app:layout_constraintBottom_toBottomOf="parent"
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintTop_toTopOf="parent"
+        app:srcCompat="@drawable/correct_background" />
+
+    <ImageView
+        android:id="@+id/nextbtn"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        app:layout_constraintBottom_toBottomOf="parent"
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintTop_toTopOf="parent"
+        app:layout_constraintVertical_bias="0.736"
+        app:srcCompat="@drawable/nextbtn" />
+
+    <TextView
+        android:id="@+id/content_txt"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:text="TextView"
+        app:layout_constraintBottom_toBottomOf="parent"
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintHorizontal_bias="0.498"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintTop_toTopOf="parent"
+        app:layout_constraintVertical_bias="0.404" />
+
+    <TextView
+        android:id="@+id/back_txt"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:text="TextView"
+        app:layout_constraintBottom_toBottomOf="parent"
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintHorizontal_bias="0.498"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintTop_toTopOf="parent"
+        app:layout_constraintVertical_bias="0.726" />
+</androidx.constraintlayout.widget.ConstraintLayout>
\ No newline at end of file
Index: app/src/main/java/com/example/easybus/edit_password.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.easybus;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.ActionBar;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.os.Bundle;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.android.volley.AuthFailureError;\r\nimport com.android.volley.Request;\r\nimport com.android.volley.RequestQueue;\r\nimport com.android.volley.Response;\r\nimport com.android.volley.VolleyError;\r\nimport com.android.volley.toolbox.JsonObjectRequest;\r\nimport com.android.volley.toolbox.StringRequest;\r\nimport com.android.volley.toolbox.Volley;\r\n\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\npublic class edit_password extends AppCompatActivity {\r\n    String email, getmail, password, getpass;\r\n    EditText pas1, pas2, pas3;\r\n    public String pass1, pass2, pass3;\r\n    RequestQueue requestQueue;\r\n    Button btnok;\r\n    TextView btnback;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_edit_password);\r\n\r\n        //隱藏title bar\r\n        ActionBar actionBar = getSupportActionBar();\r\n        actionBar.hide();\r\n        pas1 = findViewById(R.id.password1);\r\n        pas2 = findViewById(R.id.password2);\r\n        pas3 = findViewById(R.id.password3);\r\n        btnok = findViewById(R.id.okBtn);\r\n        btnback = findViewById(R.id.back);\r\n        requestQueue = Volley.newRequestQueue(this);\r\n\r\n        getmail = mail();\r\n        getpass = pass();\r\n\r\n        btnback.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                readUser(email);\r\n            }\r\n        });\r\n        btnok.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                pass1 = pas1.getText().toString().trim();\r\n                pass2 = pas2.getText().toString().trim();\r\n                pass3 = pas3.getText().toString().trim();\r\n                if (pass1.isEmpty() || pass2.isEmpty() || pass3.isEmpty()){\r\n                    Toast.makeText(edit_password.this, \"不可空白\", Toast.LENGTH_SHORT).show();\r\n                }else{\r\n                    if(!pass1.equals(getpass)){\r\n                        Toast.makeText(edit_password.this, \"請輸入正確密碼\", Toast.LENGTH_SHORT).show();\r\n                    }else  if(!pass2.equals(pass3)){\r\n                        Toast.makeText(edit_password.this, \"請輸入相同密碼\", Toast.LENGTH_SHORT).show();\r\n                    }else if(pass2.equals(pass1) && pass3.equals(pass1)){\r\n                        Toast.makeText(edit_password.this, \"不可與原密碼相同\", Toast.LENGTH_SHORT).show();\r\n                    }else{\r\n                        UpdateUser(pass3);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    public void UpdateUser(final String pass3) {\r\n        String URL = Urls.url1+\"/LoginRegister/edit.php?email=\"+getmail;\r\n        StringRequest stringRequest = new StringRequest(\r\n                Request.Method.POST,\r\n                URL,\r\n                new Response.Listener<String>() {\r\n                    @Override\r\n                    public void onResponse(String response) {\r\n                        if(response.equals(\"Success\")){\r\n                            Intent intent =new Intent(edit_password.this,Login3.class);\r\n                            Toast.makeText(edit_password.this, \"請重新登入\", Toast.LENGTH_SHORT).show();\r\n                            startActivity(intent);\r\n                            finish();\r\n                        }\r\n                    }\r\n                },\r\n                new Response.ErrorListener() {\r\n                    @Override\r\n                    public void onErrorResponse(VolleyError error) {\r\n                        Toast.makeText(edit_password.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                    }\r\n                }\r\n        ) {\r\n            @Nullable\r\n            @Override\r\n            protected Map<String, String> getParams() throws AuthFailureError {\r\n                Map<String, String> parms = new HashMap<>();\r\n                parms.put(\"password\", pass3);\r\n                return parms;\r\n            }\r\n        };\r\n        requestQueue.add(stringRequest);\r\n    }\r\n\r\n    public String mail() {\r\n        Bundle extras = getIntent().getExtras();\r\n        if (extras != null) {\r\n            email = extras.getString(\"email\");\r\n        }\r\n        return email;\r\n    }\r\n\r\n    public String pass() {\r\n        Bundle extras = getIntent().getExtras();\r\n        if (extras != null) {\r\n            password = extras.getString(\"password\");\r\n        }\r\n        return password;\r\n    }\r\n    public void readUser(final String email){\r\n        String URL =Urls.url1+\"/LoginRegister/fetch.php?email=\"+email;\r\n        JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(\r\n                Request.Method.GET,\r\n                URL,\r\n                null,\r\n                new Response.Listener<JSONObject>() {\r\n                    String identity;\r\n                    @Override\r\n                    public void onResponse(JSONObject response) {\r\n                        try {\r\n                            identity = response.getString(\"identity\");\r\n                            turnpage(identity);\r\n                        } catch (JSONException e) {\r\n                            e.printStackTrace();\r\n                            Toast.makeText(edit_password.this, e.toString(), Toast.LENGTH_SHORT).show();\r\n                        }\r\n                    }\r\n                },\r\n                new Response.ErrorListener() {\r\n                    @Override\r\n                    public void onErrorResponse(VolleyError error) {\r\n                        Toast.makeText(edit_password.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                    }\r\n                }\r\n        );\r\n        requestQueue.add(jsonObjectRequest);\r\n    }\r\n\r\n    private void turnpage(String identity) {\r\n\r\n        if(\"requester\".equalsIgnoreCase(identity)) {\r\n            Intent it4 = new Intent(edit_password.this,Page8Activity.class);\r\n            it4.putExtra(\"email\", email);\r\n            startActivity(it4);\r\n        }else if(\"caregiver\".equalsIgnoreCase(identity)){\r\n            Intent it = new Intent(edit_password.this,Page8Activity_caregiver.class);\r\n            it.putExtra(\"email\", email);\r\n            startActivity(it);\r\n\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/easybus/edit_password.java	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
+++ app/src/main/java/com/example/easybus/edit_password.java	(date 1629102578675)
@@ -44,6 +44,9 @@
         //隱藏title bar
         ActionBar actionBar = getSupportActionBar();
         actionBar.hide();
+        //抓取email
+        SharedPreferences email = getSharedPreferences("email",MODE_PRIVATE);
+        getmail=email.getString("Email","");
         pas1 = findViewById(R.id.password1);
         pas2 = findViewById(R.id.password2);
         pas3 = findViewById(R.id.password3);
@@ -51,13 +54,14 @@
         btnback = findViewById(R.id.back);
         requestQueue = Volley.newRequestQueue(this);
 
-        getmail = mail();
-        getpass = pass();
-
+        //getmail = mail();
+        //getpass = pass();4
+        readUserpass();
+        System.out.println("pass : "+getpass);
         btnback.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
-                readUser(email);
+                readUser();
             }
         });
         btnok.setOnClickListener(new View.OnClickListener() {
@@ -101,7 +105,7 @@
                 new Response.ErrorListener() {
                     @Override
                     public void onErrorResponse(VolleyError error) {
-                        Toast.makeText(edit_password.this, error.toString(), Toast.LENGTH_SHORT).show();
+                        Toast.makeText(edit_password.this, "there : "+error.toString(), Toast.LENGTH_SHORT).show();
                     }
                 }
         ) {
@@ -116,23 +120,23 @@
         requestQueue.add(stringRequest);
     }
 
-    public String mail() {
+    /*public String mail() {
         Bundle extras = getIntent().getExtras();
         if (extras != null) {
             email = extras.getString("email");
         }
         return email;
-    }
+    }*/
 
-    public String pass() {
-        Bundle extras = getIntent().getExtras();
+    public String pass(String getpass) {
+        /*Bundle extras = getIntent().getExtras();
         if (extras != null) {
             password = extras.getString("password");
-        }
-        return password;
+        }*/
+        return getpass;
     }
-    public void readUser(final String email){
-        String URL =Urls.url1+"/LoginRegister/fetch.php?email="+email;
+    public void readUser(){
+        String URL =Urls.url1+"/LoginRegister/fetch.php?email="+getmail;
         JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(
                 Request.Method.GET,
                 URL,
@@ -159,6 +163,35 @@
         );
         requestQueue.add(jsonObjectRequest);
     }
+    public void readUserpass(){
+        String URL =Urls.url1+"/LoginRegister/fetch.php?email="+getmail;
+        JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(
+                Request.Method.GET,
+                URL,
+                null,
+                new Response.Listener<JSONObject>() {
+                    String mypass;
+                    @Override
+                    public void onResponse(JSONObject response) {
+                        try {
+                            mypass = response.getString("password");
+                            System.out.println(mypass);
+                            getpass = pass(mypass);
+                        } catch (JSONException e) {
+                            e.printStackTrace();
+                            Toast.makeText(edit_password.this, e.toString(), Toast.LENGTH_SHORT).show();
+                        }
+                    }
+                },
+                new Response.ErrorListener() {
+                    @Override
+                    public void onErrorResponse(VolleyError error) {
+                        Toast.makeText(edit_password.this, error.toString(), Toast.LENGTH_SHORT).show();
+                    }
+                }
+        );
+        requestQueue.add(jsonObjectRequest);
+    }
 
     private void turnpage(String identity) {
 
Index: app/src/main/java/com/example/easybus/Page8Activity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.easybus;\r\n\r\n\r\nimport android.Manifest;\r\nimport android.app.Activity;\r\nimport android.content.ContentResolver;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.content.pm.PackageManager;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.BitmapFactory;\r\nimport android.net.Uri;\r\nimport android.os.Build;\r\nimport android.os.Bundle;\r\nimport android.os.Environment;\r\nimport android.os.Handler;\r\nimport android.os.Looper;\r\nimport android.provider.MediaStore;\r\nimport android.util.Base64;\r\nimport android.view.Gravity;\r\nimport android.view.View;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.ActionBar;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.core.app.ActivityCompat;\r\nimport androidx.core.content.ContextCompat;\r\nimport androidx.core.content.FileProvider;\r\n\r\nimport com.android.volley.AuthFailureError;\r\nimport com.android.volley.Request;\r\nimport com.android.volley.RequestQueue;\r\nimport com.android.volley.Response;\r\nimport com.android.volley.VolleyError;\r\nimport com.android.volley.toolbox.JsonObjectRequest;\r\nimport com.android.volley.toolbox.StringRequest;\r\nimport com.android.volley.toolbox.Volley;\r\nimport com.squareup.picasso.Callback;\r\nimport com.squareup.picasso.Picasso;\r\nimport com.vishnusivadas.advanced_httpurlconnection.PutData;\r\n\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.io.File;\r\nimport java.io.FileNotFoundException;\r\nimport java.io.IOException;\r\nimport java.text.SimpleDateFormat;\r\nimport java.util.Date;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\nimport de.hdodenhof.circleimageview.CircleImageView;\r\n\r\npublic class Page8Activity extends AppCompatActivity {\r\n    SelectPicPopupWindow menuWindow; //自訂義的彈出框類別(SelectPicPopupWindow)\r\n\r\n    ImageView backBtn,editpassword,qrcode,emergency,mycontact,logout;\r\n    CircleImageView mPforfilepic;\r\n\r\n    TextView mEnteredName,myphone;\r\n    String identity;\r\n    public static final int SELECT_PHOTO=1;\r\n    public static final int TAKE_PHOTO = 3;\r\n    private Uri imageUri;\r\n    private Context mContext;\r\n    public String email,getmail,password,getpass,fullname,pic,phone,encodeimage,img;\r\n    RequestQueue requestQueue;\r\n    String url =Urls.url1+\"/LoginRegister/savepic.php?fullname=\"+fullname;\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_page8);\r\n\r\n        //隱藏title bar\r\n        ActionBar actionBar = getSupportActionBar();\r\n        actionBar.hide();\r\n\r\n        backBtn=findViewById(R.id.backicon);\r\n        mEnteredName = findViewById(R.id.EnteredName);\r\n        mPforfilepic = findViewById(R.id.profilepic);\r\n        myphone = findViewById(R.id.txt1);\r\n        editpassword=findViewById(R.id.frame2);\r\n        qrcode = findViewById(R.id.frame3);\r\n        emergency = findViewById(R.id.frame4);\r\n        mycontact = findViewById(R.id.frame5);\r\n        logout = findViewById(R.id.frame8);\r\n        mContext = Page8Activity.this;\r\n\r\n        requestQueue = Volley.newRequestQueue(this);\r\n        getmail=mail();\r\n        getpass=pass();\r\n        readUser();\r\n        fetchimage();\r\n        ImageRetriveWithPicasso();\r\n        //我的聯絡人\r\n        mycontact.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(Page8Activity.this,my_contact.class);\r\n                intent.putExtra(\"email\",getmail);\r\n                startActivity(intent);\r\n                finish();\r\n            }\r\n        });\r\n        //新增緊急聯絡人\r\n        emergency.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(Page8Activity.this,emergency_contact.class);\r\n                intent.putExtra(\"email\",getmail);\r\n                startActivity(intent);\r\n                finish();\r\n            }\r\n        });\r\n        //登出\r\n        logout.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                SharedPreferences email = getSharedPreferences(\"email\",MODE_PRIVATE);\r\n                email.edit().clear().commit();\r\n                Intent it = new Intent(Page8Activity.this,Login3.class);\r\n                startActivity(it);\r\n            }\r\n        });\r\n\r\n        //QRcode\r\n        qrcode.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(Page8Activity.this,qrcode_page.class);\r\n                intent.putExtra(\"email\",getmail);\r\n                startActivity(intent);\r\n                finish();\r\n            }\r\n        });\r\n\r\n        //修改密碼\r\n        editpassword.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(Page8Activity.this,edit_password.class);\r\n                intent.putExtra(\"email\",getmail);\r\n                intent.putExtra(\"password\",getpass);\r\n                startActivity(intent);\r\n                finish();\r\n\r\n            }\r\n        });\r\n        //返回健(回選單)\r\n        backBtn.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                if(\"requester\".equalsIgnoreCase(identity)) {\r\n                    Intent it4 = new Intent(Page8Activity.this, Page3Activity.class);\r\n                    it4.putExtra(\"email\", getmail);\r\n                    startActivity(it4);\r\n                }else if(\"caregiver\".equalsIgnoreCase(identity)){\r\n                    Intent it = new Intent(Page8Activity.this,Page4Activity.class);\r\n                    it.putExtra(\"email\",getmail);\r\n                    startActivity(it);\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n        mPforfilepic.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                //實例化SelectPicPopupWindow\r\n                menuWindow = new SelectPicPopupWindow(Page8Activity.this, itemsOnClick);\r\n                //設計彈出框\r\n                menuWindow.showAtLocation(Page8Activity.this.findViewById(R.id.profilepic), Gravity.BOTTOM | Gravity.CENTER_HORIZONTAL, 0, 0);\r\n            }\r\n        });\r\n    }\r\n    //抓取使用者基本資料\r\n    public void readUser(){\r\n        String URL =Urls.url1+\"/LoginRegister/fetch.php?email=\"+getmail;\r\n        JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(\r\n                Request.Method.GET,\r\n                URL,\r\n                null,\r\n                new Response.Listener<JSONObject>() {\r\n                    @Override\r\n                    public void onResponse(JSONObject response) {\r\n                        try {\r\n                            fullname = response.getString(\"fullname\");\r\n                            phone = response.getString(\"userphone\");\r\n                            identity = response.getString(\"identity\");\r\n                            myphone.setText(phone);\r\n                            mEnteredName.setText(fullname);\r\n                            img = response.getString(\"image\");\r\n                        } catch (JSONException e) {\r\n                            e.printStackTrace();\r\n                            Toast.makeText(Page8Activity.this, e.toString(), Toast.LENGTH_SHORT).show();\r\n                        }\r\n                    }\r\n                },\r\n                new Response.ErrorListener() {\r\n                    @Override\r\n                    public void onErrorResponse(VolleyError error) {\r\n                        Toast.makeText(Page8Activity.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                    }\r\n                }\r\n        );\r\n        requestQueue.add(jsonObjectRequest);\r\n    }\r\n    //儲存頭貼\r\n    private void savepic(){\r\n        String URL =Urls.url1+\"/LoginRegister/upload.php?email=\"+getmail;\r\n        StringRequest request = new StringRequest(Request.Method.POST, URL, new Response.Listener<String>() {\r\n            @Override\r\n            public void onResponse(String response) {\r\n                Toast.makeText(Page8Activity.this,response,Toast.LENGTH_SHORT).show();\r\n            }\r\n        }, new Response.ErrorListener() {\r\n            @Override\r\n            public void onErrorResponse(VolleyError error) {\r\n                Toast.makeText(Page8Activity.this,error.getMessage(),Toast.LENGTH_SHORT).show();\r\n            }\r\n        }){\r\n            @Override\r\n            protected Map<String, String> getParams() throws AuthFailureError {\r\n                Map<String,String> params = new HashMap<>();\r\n                params.put(\"image\",encodeimage);\r\n                return params;\r\n            }\r\n        };\r\n        RequestQueue requestQueue = Volley.newRequestQueue(Page8Activity.this);\r\n        requestQueue.add(request);\r\n    }\r\n    public  void fetchimage(){\r\n        String URL =Urls.url1+\"/LoginRegister/fetchimage.php?email=\"+getmail;\r\n        StringRequest request = new StringRequest(Request.Method.GET, URL, new Response.Listener<String>() {\r\n            @Override\r\n            public void onResponse(String response) {\r\n                try {\r\n                    JSONObject jsonObject = new JSONObject(response);\r\n                    img  = jsonObject.getString(\"image\");\r\n\r\n                    ImageRetriveWithPicasso();\r\n                } catch (JSONException e) {\r\n                    e.printStackTrace();\r\n                }\r\n            }\r\n        }, new Response.ErrorListener() {\r\n            @Override\r\n            public void onErrorResponse(VolleyError error) {\r\n                Toast.makeText(Page8Activity.this,error.getMessage(),Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n        RequestQueue requestQueue = Volley.newRequestQueue(Page8Activity.this);\r\n        requestQueue.add(request);\r\n    }\r\n    public void ImageRetriveWithPicasso() {\r\n        String imgurl = Urls.url1+\"/LoginRegister/images/\"+img;\r\n        Picasso.with(this)\r\n\r\n                .load(imgurl)\r\n                .placeholder(R.drawable.profile)\r\n                .fit()\r\n               // .error(R.drawable.ic_error_black_24dp)\r\n                .into(mPforfilepic, new Callback() {\r\n                    @Override\r\n                    public void onSuccess() {\r\n                        // 圖片讀取完成\r\n                        Toast.makeText(Page8Activity.this, \"Success\", Toast.LENGTH_SHORT).show();\r\n                    }\r\n\r\n                    @Override\r\n                    public void onError() {\r\n                        // 圖片讀取失敗\r\n                      //  Toast.makeText(Page8Activity.this, \"失敗拉幹\", Toast.LENGTH_SHORT).show();\r\n                    }\r\n                });\r\n        System.out.println(imgurl);\r\n    }\r\n\r\n\r\n    public String mail(){\r\n        Bundle extras = getIntent().getExtras();\r\n        if (extras!=null){\r\n            email=extras.getString(\"email\");\r\n        }\r\n        return email;\r\n    }\r\n    public String pass(){\r\n        Bundle extras = getIntent().getExtras();\r\n        if (extras!=null){\r\n            password=extras.getString(\"password\");\r\n        }\r\n        return password;\r\n    }\r\n    private View.OnClickListener itemsOnClick=new View.OnClickListener(){\r\n        @Override\r\n        public void onClick(View v) {\r\n            menuWindow.dismiss();\r\n            switch (v.getId()){\r\n                //拍照\r\n                case R.id.takePhotoBtn:\r\n                    takePhoto();\r\n                    break;\r\n                //相簿選擇相片\r\n                case R.id.SelectPhotoBtn:\r\n                    openAlbum();\r\n                    break;\r\n                case R.id.cancelBtn:\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n\r\n    private void openAlbum() {\r\n        Intent in=new Intent();\r\n        in.setType(\"image/*\");\r\n        in.setAction(Intent.ACTION_GET_CONTENT);\r\n        startActivityForResult(in,SELECT_PHOTO);\r\n    }\r\n\r\n    public void takePhoto() {\r\n        //時間命名圖片的名稱\r\n        SimpleDateFormat format = new SimpleDateFormat(\"yyyyMMddHHmmss\");\r\n        Date date = new Date(System.currentTimeMillis());\r\n        String filename = format.format(date);\r\n\r\n        //儲存至DCIM資料夾\r\n        File path = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM);\r\n        File outputImage = new File(path,filename+\".jpg\");\r\n\r\n        //照片更換\r\n        try {\r\n            //如果上次的照片存在,就刪除\r\n            if (outputImage.exists()) {\r\n                outputImage.delete();\r\n            }\r\n            //創一個新文件\r\n            outputImage.createNewFile();\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        //如果Android版本大於7.0\r\n        if (Build.VERSION.SDK_INT >= 24) {\r\n            imageUri = FileProvider.getUriForFile(Page8Activity.this, \"com.example.EasyBus.fileprovider\",outputImage);\r\n        }else{\r\n            imageUri = Uri.fromFile(outputImage);\r\n        }\r\n\r\n        //申請動態權限\r\n        if(ContextCompat.checkSelfPermission(mContext, Manifest.permission.CAMERA)!= PackageManager.PERMISSION_GRANTED){\r\n            ActivityCompat.requestPermissions((Activity)mContext,new String[]{Manifest.permission.CAMERA},100);\r\n        }else{\r\n            //啟動相機程序\r\n            startCamera();\r\n        }\r\n    }\r\n\r\n    private void startCamera(){\r\n        //指定圖片輸出地址為imageUri\r\n        Intent intent=new Intent(\"android.media.action.IMAGE_CAPTURE\"); //照相\r\n        intent.putExtra(MediaStore.EXTRA_OUTPUT,imageUri); //指定圖片地址\r\n        startActivityForResult(intent,TAKE_PHOTO); //啟動相機\r\n        //拍完照startActivityForResult() 结果返回onActivityResult()函数\r\n    }\r\n\r\n    // 使用startActivityForResult()方法開啟Intent的回調\r\n    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data){\r\n        switch(requestCode){\r\n            case TAKE_PHOTO:\r\n                try{\r\n                    //將圖片解析成bitmap對象\r\n                    Bitmap bitmap = BitmapFactory.decodeStream(getContentResolver().openInputStream(imageUri));\r\n                    //將圖片顯示出來\r\n                    mPforfilepic.setImageBitmap(bitmap);\r\n                    if(data!=null){\r\n                        System.out.println(\"turi\"+imageUri);\r\n                        System.out.println(\"tbitmap\"+bitmap.toString());\r\n                        pic=imageUri.toString();\r\n                        imageStore(bitmap);\r\n                        savepic();\r\n                    }else{\r\n\r\n                        Intent it4 = new Intent(Page8Activity.this, Page8Activity.class);\r\n                        it4.putExtra(\"email\",getmail);\r\n                        readUser();\r\n                        fetchimage();\r\n                        ImageRetriveWithPicasso();\r\n                        startActivity(it4);\r\n                    }\r\n\r\n                }catch(FileNotFoundException e){\r\n                    e.printStackTrace();\r\n                }\r\n                break;\r\n\r\n            case SELECT_PHOTO:\r\n                try {\r\n                    //獲取圖片\r\n                    if(data != null){\r\n                        Uri uri=data.getData();\r\n                    if(uri != null){\r\n                        ContentResolver cr = this.getContentResolver();\r\n                        Bitmap bitmap = BitmapFactory.decodeStream(cr.openInputStream(uri));\r\n                        mPforfilepic.setImageBitmap(bitmap);\r\n                        imageStore(bitmap);\r\n                        System.out.println(\"suri\"+uri);\r\n                        System.out.println(\"sbitmap\"+bitmap.toString());\r\n                        pic=uri.toString();\r\n                        savepic();\r\n                    }\r\n                    }else{\r\n                        Intent it4 = new Intent(Page8Activity.this, Page8Activity.class);\r\n                        it4.putExtra(\"email\",getmail);\r\n                        readUser();\r\n                        fetchimage();\r\n                        ImageRetriveWithPicasso();\r\n                        startActivity(it4);\r\n                    }\r\n\r\n                } catch (FileNotFoundException e) {\r\n\r\n                    e.printStackTrace();\r\n\r\n                }\r\n                super.onActivityResult(requestCode, resultCode, data);\r\n                break;\r\n\r\n            default:\r\n                break;\r\n\r\n        }\r\n    }\r\n\r\n    private void imageStore(Bitmap bitmap) {\r\n        ByteArrayOutputStream stream = new ByteArrayOutputStream();\r\n        bitmap.compress(Bitmap.CompressFormat.JPEG,100,stream);\r\n        byte[] imageBytes = stream.toByteArray();\r\n        encodeimage = android.util.Base64.encodeToString(imageBytes, Base64.DEFAULT);\r\n    }\r\n\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/easybus/Page8Activity.java	(revision 118506f010e211c14e8ebe6532e2d2eb591100e9)
+++ app/src/main/java/com/example/easybus/Page8Activity.java	(date 1628844044104)
@@ -80,6 +80,9 @@
         //隱藏title bar
         ActionBar actionBar = getSupportActionBar();
         actionBar.hide();
+        //抓取email
+        SharedPreferences email = getSharedPreferences("email",MODE_PRIVATE);
+        getmail=email.getString("Email","");
 
         backBtn=findViewById(R.id.backicon);
         mEnteredName = findViewById(R.id.EnteredName);
@@ -93,8 +96,8 @@
         mContext = Page8Activity.this;
 
         requestQueue = Volley.newRequestQueue(this);
-        getmail=mail();
-        getpass=pass();
+        //getmail=mail();
+        //getpass=pass();
         readUser();
         fetchimage();
         ImageRetriveWithPicasso();
@@ -145,8 +148,8 @@
             @Override
             public void onClick(View v) {
                 Intent intent = new Intent(Page8Activity.this,edit_password.class);
-                intent.putExtra("email",getmail);
-                intent.putExtra("password",getpass);
+                //intent.putExtra("email",getmail);
+                //intent.putExtra("password",getpass);
                 startActivity(intent);
                 finish();
 
