Index: app/src/main/java/com/example/easybus/Page5012Activity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.easybus;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.ActionBar;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport android.app.ProgressDialog;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.ColorMatrix;\r\nimport android.graphics.ColorMatrixColorFilter;\r\nimport android.graphics.drawable.ColorDrawable;\r\nimport android.os.Bundle;\r\nimport android.util.Base64;\r\nimport android.view.Gravity;\r\nimport android.view.LayoutInflater;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.PopupWindow;\r\nimport android.widget.RelativeLayout;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.android.volley.AuthFailureError;\r\nimport com.android.volley.Request;\r\nimport com.android.volley.RequestQueue;\r\nimport com.android.volley.Response;\r\nimport com.android.volley.VolleyError;\r\nimport com.android.volley.toolbox.JsonObjectRequest;\r\nimport com.android.volley.toolbox.StringRequest;\r\nimport com.android.volley.toolbox.Volley;\r\n\r\nimport org.json.JSONArray;\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\npublic class Page5012Activity extends AppCompatActivity {\r\n    //12345\r\n    private static final String DIRECTION_URL_API = \"https://maps.googleapis.com/maps/api/directions/json?\";\r\n    private static final String GOOGLE_API_KEY = \"AIzaSyCr_-3KbvHxSm9Gb38l7M2E_b8qzwHhcTI\";\r\n    String url,urlOrigin,urlDestination,title2,getmail;\r\n    ImageView mImg,mBack,mAdd;\r\n    RecyclerView recyclerView;\r\n    BusInfoAdaptor adaptor;\r\n    ArrayList<BusInfo> businfos;\r\n    RequestQueue requestQueue,requestQueue1;\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_page5012);\r\n\r\n        //隱藏title bar\r\n        ActionBar actionBar = getSupportActionBar();\r\n        actionBar.hide();\r\n\r\n        //取值(origin,destination)\r\n        Bundle bundle = getIntent().getExtras();\r\n        urlOrigin= bundle.getString(\"origin2\");\r\n        urlDestination= bundle.getString(\"destination2\");\r\n\r\n        url=DIRECTION_URL_API+\"origin=\"+urlOrigin+\"&destination=\"+urlDestination+\"&mode=transit&transit_mode=bus&language=zh-TW&key=\"+GOOGLE_API_KEY;\r\n        System.out.println(url);\r\n        mImg=findViewById(R.id.img);\r\n        mBack=findViewById(R.id.backicon);\r\n        mAdd=findViewById(R.id.addIcon);\r\n        recyclerView=findViewById(R.id.busInfo);\r\n\r\n        recyclerView.setLayoutManager(new LinearLayoutManager(this));\r\n        adaptor=new BusInfoAdaptor();\r\n        recyclerView.setAdapter(adaptor);\r\n        businfos=new ArrayList<>();\r\n        getData();\r\n        SharedPreferences email = getSharedPreferences(\"email\",MODE_PRIVATE);\r\n        getmail=email.getString(\"Email\",\"\");\r\n        requestQueue = Volley.newRequestQueue(this);\r\n        requestQueue1 = Volley.newRequestQueue(this);\r\n\r\n        mAdd.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                //實例化mPopupWindow\r\n                popupWindow popupWin=new popupWindow(Page5012Activity.this);\r\n                View view= LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupwindow,null);\r\n                //設計彈出框\r\n                popupWin.showAtLocation(view,Gravity.CENTER,0,0);\r\n\r\n            }\r\n        });\r\n\r\n        mBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                finish();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void getData() { //抓公車JSON\r\n        final ProgressDialog progressDialog=new ProgressDialog(this);\r\n        progressDialog.setMessage(\"載入中...\");\r\n        progressDialog.show();\r\n\r\n        final JsonObjectRequest jsonObjectRequest=new JsonObjectRequest(url,null, new Response.Listener<JSONObject>() {\r\n            @Override\r\n            public void onResponse(JSONObject response) {\r\n                try{\r\n                    JSONArray ArrayRoutes = response.getJSONArray(\"routes\");\r\n                    JSONArray ArrayLegs =ArrayRoutes.getJSONObject(0).getJSONArray(\"legs\");\r\n                    JSONArray ArraySteps =ArrayLegs.getJSONObject(0).getJSONArray(\"steps\");\r\n\r\n                    for(int i=0;i<ArraySteps.length();i++){\r\n                        JSONObject ObjSteps=ArraySteps.getJSONObject(i);\r\n                        String travelMode=ObjSteps.getString(\"travel_mode\");\r\n                        BusInfo businfo=new BusInfo();\r\n\r\n                        if (travelMode.equals(\"WALKING\")) {\r\n                            String Htmlinstructions=ObjSteps.getString(\"html_instructions\");\r\n                            businfo.setHtmlinstructions(Htmlinstructions.substring(3));\r\n                            businfo.setShortname(null);\r\n                            businfo.setPic(1);\r\n                        }else{\r\n                            businfo.setHtmlinstructions (ObjSteps.getJSONObject(\"transit_details\").getJSONObject(\"arrival_stop\").getString(\"name\"));\r\n                            businfo.setShortname(ObjSteps.getJSONObject(\"transit_details\").getJSONObject(\"line\").getString(\"short_name\"));\r\n                            businfo.setPic(0);\r\n                        }\r\n                        businfos.add(businfo);\r\n                    }\r\n                }catch (JSONException e){\r\n                    Toast.makeText(Page5012Activity.this,e.getMessage()+\"錯誤1\",Toast.LENGTH_LONG).show();\r\n                }\r\n                adaptor.setData(businfos);\r\n                adaptor.notifyDataSetChanged();\r\n                progressDialog.dismiss();\r\n            }\r\n        }, new Response.ErrorListener() {\r\n            @Override\r\n            public void onErrorResponse(VolleyError error) {\r\n                progressDialog.dismiss();\r\n                Toast.makeText(Page5012Activity.this,\"發生錯誤1111!\",Toast.LENGTH_LONG).show();\r\n            }\r\n        });\r\n\r\n        RequestQueue requestQueue= Volley.newRequestQueue(this);\r\n        requestQueue.add(jsonObjectRequest);\r\n    }\r\n\r\n    //標題popupwindow\r\n    public class popupWindow extends PopupWindow implements View.OnClickListener {\r\n        View view;\r\n        EditText mTitle;\r\n        TextView mNext;\r\n\r\n        public popupWindow(Context mContext) {\r\n            //動態頁面載入\r\n            view = LayoutInflater.from(mContext).inflate(R.layout.page5012popupwindow, null);\r\n            mTitle = view.findViewById(R.id.title);\r\n            mNext = view.findViewById(R.id.next);\r\n            //下一步前檢查是否有輸入標題\r\n            mNext.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    TitleRequest(); //檢查標題是否為空\r\n                }\r\n            });\r\n            //設置PopupWindow的View\r\n            this.setContentView(view);\r\n            //設置PopupWindow彈出框的高\r\n            this.setHeight(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置PopupWindow彈出框的寬\r\n            this.setWidth(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置mPopupWindow彈出框可點擊\r\n            this.setFocusable(true);\r\n            //實例化一個ColorDrawable顏色為半透明\r\n            ColorDrawable dw = new ColorDrawable(0xb0000000);\r\n            //設置PopupWindow彈出框的背景\r\n            this.setBackgroundDrawable(dw);\r\n            //設置PopupWindow點框外銷毀\r\n            this.setOutsideTouchable(true);\r\n            view.setOnTouchListener(new View.OnTouchListener() {\r\n                @Override\r\n                public boolean onTouch(View v, MotionEvent motionEvent) {\r\n                    int top=view.findViewById(R.id.img).getTop();\r\n                    int bottom=view.findViewById(R.id.img).getBottom();\r\n                    int left=view.findViewById(R.id.img).getLeft();\r\n                    int right=view.findViewById(R.id.img).getRight();\r\n                    int y=(int)motionEvent.getY();\r\n                    int x=(int)motionEvent.getX();\r\n                    if (motionEvent.getAction()==MotionEvent.ACTION_UP){\r\n                        if (y<top || y>bottom || x<left || x>right)\r\n                            dismiss();\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n        }\r\n        @Override\r\n        public void onClick(View V) {\r\n        }\r\n\r\n        //檢查標題是否為空(如不是:選擇圖片)\r\n        public void TitleRequest(){\r\n            title2=mTitle.getText().toString().trim();\r\n            if (title2.isEmpty()){\r\n                Toast.makeText(Page5012Activity.this, \"請輸入標題\", Toast.LENGTH_LONG).show();\r\n                return;\r\n            }else{  //選擇圖片popupwindow\r\n                //銷毀第一個popupwindow\r\n                savebusinfo(getmail,title2,url);\r\n                dismiss();\r\n                //實例化PopupPhoto\r\n                popupSelPhoto popupPhoto=new popupSelPhoto(Page5012Activity.this);\r\n                View v=LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupphoto,null);\r\n                //設計彈出框\r\n                popupPhoto.showAtLocation(v,Gravity.CENTER,0,0);\r\n            }\r\n        }\r\n\r\n        public void savebusinfo(final String email,final String routename,final String route) {\r\n            String URL = Urls.url1+\"/LoginRegister/save_businfo.php\";\r\n            StringRequest stringRequest = new StringRequest(\r\n                    Request.Method.POST,\r\n                    URL,\r\n                    new Response.Listener<String>() {\r\n                        @Override\r\n                        public void onResponse(String response) {\r\n                            if(response.equals(\"Success\")){\r\n                                finish();\r\n                            }\r\n                        }\r\n                    },\r\n                    new Response.ErrorListener() {\r\n                        @Override\r\n                        public void onErrorResponse(VolleyError error) {\r\n                            Toast.makeText(Page5012Activity.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                        }\r\n                    }\r\n            ) {\r\n                @Nullable\r\n                @Override\r\n                protected Map<String, String> getParams() throws AuthFailureError {\r\n                    Map<String, String> parms = new HashMap<>();\r\n                    parms.put(\"email\",email);\r\n                    parms.put(\"routename\",routename);\r\n                    parms.put(\"route\",route);\r\n                    return parms;\r\n                }\r\n            };\r\n            requestQueue1.add(stringRequest);\r\n        }\r\n    }\r\n\r\n    //標題popupSelPhoto\r\n    public class popupSelPhoto extends PopupWindow implements View.OnClickListener{\r\n        View v;\r\n        ImageView mWork,mHome,mPlay,mShopping,mSaveImg;\r\n        int choose=0;\r\n        String img = \"\";\r\n        public popupSelPhoto(Context mContext2) {\r\n            //動態頁面載入\r\n            v = LayoutInflater.from(mContext2).inflate(R.layout.page5012popupphoto, null);\r\n\r\n            mWork=v.findViewById(R.id.work);\r\n            mHome=v.findViewById(R.id.home);\r\n            mPlay=v.findViewById(R.id.play);\r\n            mShopping=v.findViewById(R.id.shopping);\r\n            mSaveImg=v.findViewById(R.id.saveImg);\r\n\r\n            //設置PopupWindow的View\r\n            this.setContentView(v);\r\n            //設置PopupWindow彈出框的高\r\n            this.setHeight(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置PopupWindow彈出框的寬\r\n            this.setWidth(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置mPopupWindow彈出框可點擊\r\n            this.setFocusable(true);\r\n            //實例化一個ColorDrawable顏色為半透明\r\n            ColorDrawable dw = new ColorDrawable(0xb0000000);\r\n            //設置PopupWindow彈出框的背景\r\n            this.setBackgroundDrawable(dw);\r\n            //設置PopupWindow點框外銷毀\r\n            this.setOutsideTouchable(true);\r\n            v.setOnTouchListener(new View.OnTouchListener() {\r\n                @Override\r\n                public boolean onTouch(View view, MotionEvent motionEvent) {\r\n                    int height=v.findViewById(R.id.selphotobg).getHeight();\r\n                    int y=(int)motionEvent.getY();\r\n                    if (motionEvent.getAction()==MotionEvent.ACTION_UP){\r\n                        if (y<height){\r\n                            dismiss();\r\n                        }\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            mWork.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=1;\r\n                    if (choose==1){\r\n                        mWork.setImageResource(R.drawable.working1);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"work\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mHome.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=2;\r\n                    if (choose==2){\r\n                        mHome.setImageResource(R.drawable.home1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"home\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mPlay.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=3;\r\n                    if (choose==3){\r\n                        mPlay.setImageResource(R.drawable.play1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                        img = \"play\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mShopping.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=4;\r\n                    if (choose==4){\r\n                        mShopping.setImageResource(R.drawable.shopping1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        img = \"shopping\";\r\n                    }\r\n                }\r\n            });\r\n\r\n            mSaveImg.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose+=1;\r\n                    if (choose>=2 && choose<=5){ //有選擇照片\r\n                        System.out.println(choose);\r\n                        dismiss();\r\n                        //將資訊存入資料庫\r\n                        savepic(img);\r\n                        System.out.println(img);\r\n                        Toast.makeText(Page5012Activity.this,\"路線儲存成功！\",Toast.LENGTH_LONG).show();\r\n                    }else{ //沒有選照片\r\n                        Toast.makeText(Page5012Activity.this,\"請選擇圖片！\",Toast.LENGTH_LONG).show();\r\n                    }\r\n                }\r\n            });\r\n\r\n        }\r\n\r\n        @Override\r\n        public void onClick(View view) {\r\n        }\r\n        public void savepic(final String img) {\r\n            String URL = Urls.url1+\"/LoginRegister/savepic.php?email=\"+getmail;\r\n            StringRequest stringRequest = new StringRequest(\r\n                    Request.Method.POST,\r\n                    URL,\r\n                    new Response.Listener<String>() {\r\n                        @Override\r\n                        public void onResponse(String response) {\r\n                            if(response.equals(\"Success\")){\r\n                                finish();\r\n                            }\r\n                        }\r\n                    },\r\n                    new Response.ErrorListener() {\r\n                        @Override\r\n                        public void onErrorResponse(VolleyError error) {\r\n                            Toast.makeText(Page5012Activity.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                        }\r\n                    }\r\n            ) {\r\n                @Nullable\r\n                @Override\r\n                protected Map<String, String> getParams() throws AuthFailureError {\r\n                    Map<String, String> parms = new HashMap<>();\r\n                    parms.put(\"image\",img);\r\n                    return parms;\r\n                }\r\n            };\r\n            requestQueue.add(stringRequest);\r\n        }\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/easybus/Page5012Activity.java	(revision e3f3d62adc5dd6d511ee22fd4c5038264c767fde)
+++ app/src/main/java/com/example/easybus/Page5012Activity.java	(date 1628236941761)
@@ -70,7 +70,7 @@
         urlDestination= bundle.getString("destination2");
 
         url=DIRECTION_URL_API+"origin="+urlOrigin+"&destination="+urlDestination+"&mode=transit&transit_mode=bus&language=zh-TW&key="+GOOGLE_API_KEY;
-        System.out.println(url);
+
         mImg=findViewById(R.id.img);
         mBack=findViewById(R.id.backicon);
         mAdd=findViewById(R.id.addIcon);
@@ -216,48 +216,19 @@
                 return;
             }else{  //選擇圖片popupwindow
                 //銷毀第一個popupwindow
-                savebusinfo(getmail,title2,url);
+
                 dismiss();
                 //實例化PopupPhoto
                 popupSelPhoto popupPhoto=new popupSelPhoto(Page5012Activity.this);
                 View v=LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupphoto,null);
                 //設計彈出框
                 popupPhoto.showAtLocation(v,Gravity.CENTER,0,0);
+                //title2=popupPhoto.title;
+                popupPhoto.title=title2;
             }
         }
 
-        public void savebusinfo(final String email,final String routename,final String route) {
-            String URL = Urls.url1+"/LoginRegister/save_businfo.php";
-            StringRequest stringRequest = new StringRequest(
-                    Request.Method.POST,
-                    URL,
-                    new Response.Listener<String>() {
-                        @Override
-                        public void onResponse(String response) {
-                            if(response.equals("Success")){
-                                finish();
-                            }
-                        }
-                    },
-                    new Response.ErrorListener() {
-                        @Override
-                        public void onErrorResponse(VolleyError error) {
-                            Toast.makeText(Page5012Activity.this, error.toString(), Toast.LENGTH_SHORT).show();
-                        }
-                    }
-            ) {
-                @Nullable
-                @Override
-                protected Map<String, String> getParams() throws AuthFailureError {
-                    Map<String, String> parms = new HashMap<>();
-                    parms.put("email",email);
-                    parms.put("routename",routename);
-                    parms.put("route",route);
-                    return parms;
-                }
-            };
-            requestQueue1.add(stringRequest);
-        }
+
     }
 
     //標題popupSelPhoto
@@ -265,7 +236,7 @@
         View v;
         ImageView mWork,mHome,mPlay,mShopping,mSaveImg;
         int choose=0;
-        String img = "";
+        String title,img = "";
         public popupSelPhoto(Context mContext2) {
             //動態頁面載入
             v = LayoutInflater.from(mContext2).inflate(R.layout.page5012popupphoto, null);
@@ -366,9 +337,12 @@
                     choose+=1;
                     if (choose>=2 && choose<=5){ //有選擇照片
                         System.out.println(choose);
+                        System.out.println("title : "+title);
+                        System.out.println(url);
                         dismiss();
                         //將資訊存入資料庫
-                        savepic(img);
+                        savebusinfo(getmail,title,url,img);
+
                         System.out.println(img);
                         Toast.makeText(Page5012Activity.this,"路線儲存成功！",Toast.LENGTH_LONG).show();
                     }else{ //沒有選照片
@@ -382,8 +356,8 @@
         @Override
         public void onClick(View view) {
         }
-        public void savepic(final String img) {
-            String URL = Urls.url1+"/LoginRegister/savepic.php?email="+getmail;
+        public void savebusinfo(final String email,final String routename,final String route,final String img) {
+            String URL = Urls.url1+"/LoginRegister/save_businfo.php";
             StringRequest stringRequest = new StringRequest(
                     Request.Method.POST,
                     URL,
@@ -406,11 +380,14 @@
                 @Override
                 protected Map<String, String> getParams() throws AuthFailureError {
                     Map<String, String> parms = new HashMap<>();
+                    parms.put("email",email);
+                    parms.put("routename",routename);
+                    parms.put("route",route);
                     parms.put("image",img);
                     return parms;
                 }
             };
-            requestQueue.add(stringRequest);
+            requestQueue1.add(stringRequest);
         }
     }
 
Index: app/src/main/java/com/example/easybus/Urls.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.easybus;\r\nimport java.net.InetAddress;\r\nimport java.net.UnknownHostException;\r\n\r\npublic class Urls {\r\n    //private static InetAddress ip;/////\r\n    public static String url1 = \"http://192.168.137.1\";\r\n    //public static String url1 = \"http://8c708b26959c.ngrok.io\";\r\n    public static void main(String args[]) {\r\n\r\n        /*try {\r\n            ip = InetAddress.getLocalHost();\r\n            System.out.println(ip.getHostAddress());\r\n        } catch (UnknownHostException e) {\r\n            e.printStackTrace();\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n        }*/\r\n\r\n\r\n\r\n    }\r\n    //static String ROOT_URL = url1+url2+url3;\r\n    //static String FORGOT_PASSWORD_URL = \"http://192.168.27.107/LoginRegister/\" + \"forgot.php\";\r\n//搞不清楚 你不是說要用appple 對阿 可是不能merge 現在又說EasyBus 有問題\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/easybus/Urls.java	(revision e3f3d62adc5dd6d511ee22fd4c5038264c767fde)
+++ app/src/main/java/com/example/easybus/Urls.java	(date 1628236198824)
@@ -4,7 +4,7 @@
 
 public class Urls {
     //private static InetAddress ip;/////
-    public static String url1 = "http://192.168.137.1";
+    public static String url1 = "http://192.168.0.126";
     //public static String url1 = "http://8c708b26959c.ngrok.io";
     public static void main(String args[]) {
 
