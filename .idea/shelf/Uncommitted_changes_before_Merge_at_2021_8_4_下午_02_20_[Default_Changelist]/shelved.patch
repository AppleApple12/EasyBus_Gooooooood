Index: app/src/main/AndroidManifest.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    package=\"com.example.easybus\">\r\n\r\n    <uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\r\n    <uses-permission android:name=\"android.permission.INTERNET\" />\r\n    <uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\" />\r\n    <uses-permission android:name=\"android.permission.CALL_PHONE\" />\r\n    <uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" />\r\n    <uses-permission android:name=\"android.permission.READ_EXTERNAL_STORAGE\"/>\r\n    <uses-permission android:name=\"android.permission.CAMERA\" />\r\n\r\n    <uses-feature\r\n        android:name=\"android.hardware.camera\"\r\n        android:required=\"true\" />\r\n\r\n    <application\r\n        android:allowBackup=\"true\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\r\n        android:supportsRtl=\"true\"\r\n        android:theme=\"@style/AppTheme\">\r\n\r\n        <activity android:name=\".SelectPicPopupWindow\"\r\n            tools:ignore=\"Instantiatable\"></activity>\r\n        <activity android:name=\".AddFamMember\" />\r\n        <activity android:name=\".edit\" />\r\n\r\n        <activity android:name=\".qrscanner\"/>\r\n        <activity android:name=\".emergency_contact\" />\r\n        <activity android:name=\".Page8Activity_caregiver\" />\r\n        <activity android:name=\".edit_password\" />\r\n        <activity android:name=\".my_contact\" />\r\n        <activity android:name=\".qrcode_page\" />\r\n\r\n\r\n        <activity android:name=\".Forgotpassword\" />\r\n        <activity android:name=\".Page801Activity\" />\r\n        <activity android:name=\".Page7falseActivity\" />\r\n        <activity android:name=\".Page7trueActivity\" />\r\n        <activity android:name=\".Page702Activity\" />\r\n        <activity android:name=\".Page701Activity\" />\r\n        <activity android:name=\".Login\" />\r\n        <activity android:name=\".Register\" />\r\n        <activity android:name=\".Page10Activity\" />\r\n        <activity android:name=\".Page9Activity\" />\r\n        <activity android:name=\".Page5011Activity\" />\r\n        <activity android:name=\".Page5012Activity\" />\r\n        <activity android:name=\".Login2\" />\r\n        <activity android:name=\".SignUp2\" />\r\n\r\n        <activity android:name=\".Login3\" />\r\n        <activity android:name=\".Signup3\" />\r\n        <meta-data\r\n            android:name=\"com.google.android.geo.API_KEY\"\r\n            android:value=\"@string/google_maps_key\" />\r\n\r\n        <provider\r\n            android:name=\"androidx.core.content.FileProvider\"\r\n            android:authorities=\"com.example.EasyBus.fileprovider\"\r\n            android:exported=\"false\"\r\n            android:grantUriPermissions=\"true\"\r\n            tools:ignore=\"ExtraText\">\r\n            <meta-data\r\n                android:name=\"android.support.FILE_PROVIDER_PATHS\"\r\n                android:resource=\"@xml/file_paths\" />\r\n        </provider>\r\n\r\n        <activity android:name=\".Page8Activity\" />\r\n        <activity android:name=\".Page7Activity\" />\r\n        <activity android:name=\".Page6Activity\" />\r\n        <activity android:name=\".Page4Activity\" />\r\n        <activity android:name=\".Page3Activity\" />\r\n        <activity android:name=\".Page2Activity\" />\r\n        <activity android:name=\".MainActivity\">\r\n\r\n            <intent-filter>\r\n                <action android:name=\"android.intent.action.MAIN\" />\r\n\r\n                <category android:name=\"android.intent.category.LAUNCHER\" />\r\n            </intent-filter>\r\n        </activity>\r\n        <activity\r\n            android:name=\".Capture\"\r\n            android:screenOrientation=\"portrait\"\r\n            android:stateNotNeeded=\"true\"\r\n            android:theme=\"@style/zxing_CaptureTheme\" />\r\n    </application>\r\n\r\n</manifest>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/AndroidManifest.xml	(revision 157f1e4da2b7d806954e529500baabfb788134a3)
+++ app/src/main/AndroidManifest.xml	(date 1628058010828)
@@ -8,7 +8,7 @@
     <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
     <uses-permission android:name="android.permission.CALL_PHONE" />
     <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
-    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"/>
+    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
     <uses-permission android:name="android.permission.CAMERA" />
 
     <uses-feature
@@ -22,20 +22,19 @@
         android:roundIcon="@mipmap/ic_launcher_round"
         android:supportsRtl="true"
         android:theme="@style/AppTheme">
-
-        <activity android:name=".SelectPicPopupWindow"
-            tools:ignore="Instantiatable"></activity>
+        <activity android:name=".Page62"></activity>
+        <activity android:name=".Page61" />
+        <activity
+            android:name=".SelectPicPopupWindow"
+            tools:ignore="Instantiatable" />
         <activity android:name=".AddFamMember" />
         <activity android:name=".edit" />
-
-        <activity android:name=".qrscanner"/>
+        <activity android:name=".qrscanner" />
         <activity android:name=".emergency_contact" />
         <activity android:name=".Page8Activity_caregiver" />
         <activity android:name=".edit_password" />
         <activity android:name=".my_contact" />
         <activity android:name=".qrcode_page" />
-
-
         <activity android:name=".Forgotpassword" />
         <activity android:name=".Page801Activity" />
         <activity android:name=".Page7falseActivity" />
@@ -50,9 +49,9 @@
         <activity android:name=".Page5012Activity" />
         <activity android:name=".Login2" />
         <activity android:name=".SignUp2" />
-
         <activity android:name=".Login3" />
         <activity android:name=".Signup3" />
+
         <meta-data
             android:name="com.google.android.geo.API_KEY"
             android:value="@string/google_maps_key" />
@@ -70,12 +69,12 @@
 
         <activity android:name=".Page8Activity" />
         <activity android:name=".Page7Activity" />
+        <activity android:name=".Page601" />
         <activity android:name=".Page6Activity" />
-        <activity android:name=".Page4Activity" />
         <activity android:name=".Page3Activity" />
+        <activity android:name=".MainActivity" />
         <activity android:name=".Page2Activity" />
-        <activity android:name=".MainActivity">
-
+        <activity android:name=".Page4Activity">
             <intent-filter>
                 <action android:name="android.intent.action.MAIN" />
 
Index: app/src/main/java/com/example/easybus/Page5012Activity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.easybus;\r\n\r\nimport androidx.appcompat.app.ActionBar;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport android.app.ProgressDialog;\r\nimport android.content.Context;\r\nimport android.graphics.ColorMatrix;\r\nimport android.graphics.ColorMatrixColorFilter;\r\nimport android.graphics.drawable.ColorDrawable;\r\nimport android.os.Bundle;\r\nimport android.view.Gravity;\r\nimport android.view.LayoutInflater;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.PopupWindow;\r\nimport android.widget.RelativeLayout;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.android.volley.RequestQueue;\r\nimport com.android.volley.Response;\r\nimport com.android.volley.VolleyError;\r\nimport com.android.volley.toolbox.JsonObjectRequest;\r\nimport com.android.volley.toolbox.Volley;\r\n\r\nimport org.json.JSONArray;\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.util.ArrayList;\r\n\r\npublic class Page5012Activity extends AppCompatActivity {\r\n\r\n    private static final String DIRECTION_URL_API = \"https://maps.googleapis.com/maps/api/directions/json?\";\r\n    private static final String GOOGLE_API_KEY = \"AIzaSyCr_-3KbvHxSm9Gb38l7M2E_b8qzwHhcTI\";\r\n    String url,urlOrigin,urlDestination,title2;\r\n    ImageView mImg,mBack,mAdd;\r\n    RecyclerView recyclerView;\r\n    BusInfoAdaptor adaptor;\r\n    ArrayList<BusInfo> businfos;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_page5012);\r\n\r\n        //隱藏title bar\r\n        ActionBar actionBar = getSupportActionBar();\r\n        actionBar.hide();\r\n\r\n        //取值(origin,destination)\r\n        Bundle bundle = getIntent().getExtras();\r\n        urlOrigin= bundle.getString(\"origin2\");\r\n        urlDestination= bundle.getString(\"destination2\");\r\n\r\n        url=DIRECTION_URL_API+\"origin=\"+urlOrigin+\"&destination=\"+urlDestination+\"&mode=transit&transit_mode=bus&language=zh-TW&key=\"+GOOGLE_API_KEY;\r\n\r\n        mImg=findViewById(R.id.img);\r\n        mBack=findViewById(R.id.backicon);\r\n        mAdd=findViewById(R.id.addIcon);\r\n        recyclerView=findViewById(R.id.busInfo);\r\n\r\n        recyclerView.setLayoutManager(new LinearLayoutManager(this));\r\n        adaptor=new BusInfoAdaptor();\r\n        recyclerView.setAdapter(adaptor);\r\n        businfos=new ArrayList<>();\r\n        getData();\r\n\r\n        mAdd.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                //實例化mPopupWindow\r\n                popupWindow popupWin=new popupWindow(Page5012Activity.this);\r\n                View view= LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupwindow,null);\r\n                //設計彈出框\r\n                popupWin.showAtLocation(view,Gravity.CENTER,0,0);\r\n            }\r\n        });\r\n\r\n        mBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                finish();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void getData() { //抓公車JSON\r\n        final ProgressDialog progressDialog=new ProgressDialog(this);\r\n        progressDialog.setMessage(\"載入中...\");\r\n        progressDialog.show();\r\n\r\n        final JsonObjectRequest jsonObjectRequest=new JsonObjectRequest(url,null, new Response.Listener<JSONObject>() {\r\n            @Override\r\n            public void onResponse(JSONObject response) {\r\n                try{\r\n                    JSONArray ArrayRoutes = response.getJSONArray(\"routes\");\r\n                    JSONArray ArrayLegs =ArrayRoutes.getJSONObject(0).getJSONArray(\"legs\");\r\n                    JSONArray ArraySteps =ArrayLegs.getJSONObject(0).getJSONArray(\"steps\");\r\n\r\n                    for(int i=0;i<ArraySteps.length();i++){\r\n                        JSONObject ObjSteps=ArraySteps.getJSONObject(i);\r\n                        String travelMode=ObjSteps.getString(\"travel_mode\");\r\n                        BusInfo businfo=new BusInfo();\r\n\r\n                        if (travelMode.equals(\"WALKING\")) {\r\n                            String Htmlinstructions=ObjSteps.getString(\"html_instructions\");\r\n                            businfo.setHtmlinstructions(Htmlinstructions.substring(3));\r\n                            businfo.setShortname(null);\r\n                            businfo.setPic(1);\r\n                        }else{\r\n                            businfo.setHtmlinstructions (ObjSteps.getJSONObject(\"transit_details\").getJSONObject(\"arrival_stop\").getString(\"name\"));\r\n                            businfo.setShortname(ObjSteps.getJSONObject(\"transit_details\").getJSONObject(\"line\").getString(\"short_name\"));\r\n                            businfo.setPic(0);\r\n                        }\r\n                        businfos.add(businfo);\r\n                    }\r\n                }catch (JSONException e){\r\n                    Toast.makeText(Page5012Activity.this,e.getMessage()+\"錯誤1\",Toast.LENGTH_LONG).show();\r\n                }\r\n                adaptor.setData(businfos);\r\n                adaptor.notifyDataSetChanged();\r\n                progressDialog.dismiss();\r\n            }\r\n        }, new Response.ErrorListener() {\r\n            @Override\r\n            public void onErrorResponse(VolleyError error) {\r\n                progressDialog.dismiss();\r\n                Toast.makeText(Page5012Activity.this,\"發生錯誤1111!\",Toast.LENGTH_LONG).show();\r\n            }\r\n        });\r\n\r\n        RequestQueue requestQueue= Volley.newRequestQueue(this);\r\n        requestQueue.add(jsonObjectRequest);\r\n    }\r\n\r\n    //標題popupwindow\r\n    public class popupWindow extends PopupWindow implements View.OnClickListener {\r\n        View view;\r\n        EditText mTitle;\r\n        TextView mNext;\r\n\r\n        public popupWindow(Context mContext) {\r\n            //動態頁面載入\r\n            view = LayoutInflater.from(mContext).inflate(R.layout.page5012popupwindow, null);\r\n            mTitle = view.findViewById(R.id.title);\r\n            mNext = view.findViewById(R.id.next);\r\n            //下一步前檢查是否有輸入標題\r\n            mNext.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    TitleRequest(); //檢查標題是否為空\r\n                }\r\n            });\r\n            //設置PopupWindow的View\r\n            this.setContentView(view);\r\n            //設置PopupWindow彈出框的高\r\n            this.setHeight(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置PopupWindow彈出框的寬\r\n            this.setWidth(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置mPopupWindow彈出框可點擊\r\n            this.setFocusable(true);\r\n            //實例化一個ColorDrawable顏色為半透明\r\n            ColorDrawable dw = new ColorDrawable(0xb0000000);\r\n            //設置PopupWindow彈出框的背景\r\n            this.setBackgroundDrawable(dw);\r\n            //設置PopupWindow點框外銷毀\r\n            this.setOutsideTouchable(true);\r\n            view.setOnTouchListener(new View.OnTouchListener() {\r\n                @Override\r\n                public boolean onTouch(View v, MotionEvent motionEvent) {\r\n                    int top=view.findViewById(R.id.img).getTop();\r\n                    int bottom=view.findViewById(R.id.img).getBottom();\r\n                    int left=view.findViewById(R.id.img).getLeft();\r\n                    int right=view.findViewById(R.id.img).getRight();\r\n                    int y=(int)motionEvent.getY();\r\n                    int x=(int)motionEvent.getX();\r\n                    if (motionEvent.getAction()==MotionEvent.ACTION_UP){\r\n                        if (y<top || y>bottom || x<left || x>right)\r\n                            dismiss();\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n        }\r\n        @Override\r\n        public void onClick(View V) {\r\n        }\r\n\r\n        //檢查標題是否為空(如不是:選擇圖片)\r\n        public void TitleRequest(){\r\n            title2=mTitle.getText().toString().trim();\r\n            if (title2.isEmpty()){\r\n                Toast.makeText(Page5012Activity.this, \"請輸入標題\", Toast.LENGTH_LONG).show();\r\n                return;\r\n            }else{  //選擇圖片popupwindow\r\n                //銷毀第一個popupwindow\r\n                dismiss();\r\n                //實例化PopupPhoto\r\n                popupSelPhoto popupPhoto=new popupSelPhoto(Page5012Activity.this);\r\n                View v=LayoutInflater.from(Page5012Activity.this).inflate(R.layout.page5012popupphoto,null);\r\n                //設計彈出框\r\n                popupPhoto.showAtLocation(v,Gravity.CENTER,0,0);\r\n            }\r\n        }\r\n    }\r\n\r\n    //標題popupSelPhoto\r\n    public class popupSelPhoto extends PopupWindow implements View.OnClickListener{\r\n        View v;\r\n        ImageView mWork,mHome,mPlay,mShopping,mSaveImg;\r\n        int choose=0;\r\n\r\n        public popupSelPhoto(Context mContext2) {\r\n            //動態頁面載入\r\n            v = LayoutInflater.from(mContext2).inflate(R.layout.page5012popupphoto, null);\r\n\r\n            mWork=v.findViewById(R.id.work);\r\n            mHome=v.findViewById(R.id.home);\r\n            mPlay=v.findViewById(R.id.play);\r\n            mShopping=v.findViewById(R.id.shopping);\r\n            mSaveImg=v.findViewById(R.id.saveImg);\r\n\r\n            //設置PopupWindow的View\r\n            this.setContentView(v);\r\n            //設置PopupWindow彈出框的高\r\n            this.setHeight(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置PopupWindow彈出框的寬\r\n            this.setWidth(RelativeLayout.LayoutParams.MATCH_PARENT);\r\n            //設置mPopupWindow彈出框可點擊\r\n            this.setFocusable(true);\r\n            //實例化一個ColorDrawable顏色為半透明\r\n            ColorDrawable dw = new ColorDrawable(0xb0000000);\r\n            //設置PopupWindow彈出框的背景\r\n            this.setBackgroundDrawable(dw);\r\n            //設置PopupWindow點框外銷毀\r\n            this.setOutsideTouchable(true);\r\n            v.setOnTouchListener(new View.OnTouchListener() {\r\n                @Override\r\n                public boolean onTouch(View view, MotionEvent motionEvent) {\r\n                    int height=v.findViewById(R.id.selphotobg).getHeight();\r\n                    int y=(int)motionEvent.getY();\r\n                    if (motionEvent.getAction()==MotionEvent.ACTION_UP){\r\n                        if (y<height){\r\n                            dismiss();\r\n                        }\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            mWork.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=1;\r\n                    if (choose==1){\r\n                        mWork.setImageResource(R.drawable.working1);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                    }\r\n                }\r\n            });\r\n\r\n            mHome.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=2;\r\n                    if (choose==2){\r\n                        mHome.setImageResource(R.drawable.home1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                    }\r\n                }\r\n            });\r\n\r\n            mPlay.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=3;\r\n                    if (choose==3){\r\n                        mPlay.setImageResource(R.drawable.play1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mShopping.setImageResource(R.drawable.shopping);\r\n                    }\r\n                }\r\n            });\r\n\r\n            mShopping.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose=4;\r\n                    if (choose==4){\r\n                        mShopping.setImageResource(R.drawable.shopping1);\r\n                        mWork.setImageResource(R.drawable.working);\r\n                        mHome.setImageResource(R.drawable.home);\r\n                        mPlay.setImageResource(R.drawable.play);\r\n                    }\r\n                }\r\n            });\r\n\r\n            mSaveImg.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View view) {\r\n                    choose+=1;\r\n                    if (choose>=2 && choose<=5){ //有選擇照片\r\n                        dismiss();\r\n                        //將資訊存入資料庫\r\n\r\n                        Toast.makeText(Page5012Activity.this,\"路線儲存成功！\",Toast.LENGTH_LONG).show();\r\n                    }else{ //沒有選照片\r\n                        Toast.makeText(Page5012Activity.this,\"請選擇圖片！\",Toast.LENGTH_LONG).show();\r\n                    }\r\n                }\r\n            });\r\n\r\n        }\r\n\r\n        @Override\r\n        public void onClick(View view) {\r\n        }\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/easybus/Page5012Activity.java	(revision 157f1e4da2b7d806954e529500baabfb788134a3)
+++ app/src/main/java/com/example/easybus/Page5012Activity.java	(date 1628058010885)
@@ -59,7 +59,7 @@
         urlDestination= bundle.getString("destination2");
 
         url=DIRECTION_URL_API+"origin="+urlOrigin+"&destination="+urlDestination+"&mode=transit&transit_mode=bus&language=zh-TW&key="+GOOGLE_API_KEY;
-
+        System.out.println(url);
         mImg=findViewById(R.id.img);
         mBack=findViewById(R.id.backicon);
         mAdd=findViewById(R.id.addIcon);
@@ -311,6 +311,7 @@
                 public void onClick(View view) {
                     choose+=1;
                     if (choose>=2 && choose<=5){ //有選擇照片
+                        System.out.println(choose);
                         dismiss();
                         //將資訊存入資料庫
 
