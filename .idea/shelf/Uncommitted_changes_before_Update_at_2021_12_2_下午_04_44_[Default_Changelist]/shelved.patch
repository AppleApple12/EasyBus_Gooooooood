Index: app/src/main/java/com/example/easybus/Page3Activity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.easybus;\r\n/*需求者主頁*/\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.ActionBar;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.core.app.ActivityCompat;\r\nimport androidx.core.content.ContextCompat;\r\n\r\nimport android.Manifest;\r\nimport android.annotation.SuppressLint;\r\nimport android.app.AlarmManager;\r\nimport android.app.NotificationChannel;\r\nimport android.app.NotificationManager;\r\nimport android.app.PendingIntent;\r\nimport android.content.BroadcastReceiver;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.IntentSender;\r\nimport android.content.SharedPreferences;\r\nimport android.content.pm.PackageManager;\r\nimport android.location.Location;\r\nimport android.location.LocationListener;\r\nimport android.location.LocationManager;\r\nimport android.net.Uri;\r\nimport android.os.Build;\r\nimport android.os.Bundle;\r\nimport android.os.Looper;\r\nimport android.telecom.Call;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.android.volley.AuthFailureError;\r\nimport com.android.volley.Request;\r\nimport com.android.volley.RequestQueue;\r\nimport com.android.volley.Response;\r\nimport com.android.volley.VolleyError;\r\nimport com.android.volley.toolbox.JsonObjectRequest;\r\nimport com.android.volley.toolbox.StringRequest;\r\nimport com.android.volley.toolbox.Volley;\r\nimport com.google.android.gms.common.api.ResolvableApiException;\r\nimport com.google.android.gms.location.FusedLocationProviderClient;\r\nimport com.google.android.gms.location.LocationCallback;\r\nimport com.google.android.gms.location.LocationRequest;\r\nimport com.google.android.gms.location.LocationResult;\r\nimport com.google.android.gms.location.LocationServices;\r\nimport com.google.android.gms.location.LocationSettingsRequest;\r\nimport com.google.android.gms.location.LocationSettingsResponse;\r\nimport com.google.android.gms.location.SettingsClient;\r\nimport com.google.android.gms.tasks.OnFailureListener;\r\nimport com.google.android.gms.tasks.OnSuccessListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.android.material.floatingactionbutton.FloatingActionButton;\r\nimport com.google.android.material.snackbar.Snackbar;\r\nimport com.karumi.dexter.Dexter;\r\nimport com.karumi.dexter.PermissionToken;\r\nimport com.karumi.dexter.listener.PermissionDeniedResponse;\r\nimport com.karumi.dexter.listener.PermissionGrantedResponse;\r\nimport com.karumi.dexter.listener.PermissionRequest;\r\nimport com.karumi.dexter.listener.single.PermissionListener;\r\n\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.text.DecimalFormat;\r\nimport java.text.SimpleDateFormat;\r\nimport java.util.ArrayList;\r\nimport java.util.Calendar;\r\nimport java.util.Collections;\r\nimport java.util.Comparator;\r\nimport java.util.Date;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\nimport java.util.Map;\r\nimport java.util.TimeZone;\r\n\r\nimport static android.Manifest.permission.ACCESS_COARSE_LOCATION;\r\nimport static android.Manifest.permission.ACCESS_FINE_LOCATION;\r\n\r\npublic class Page3Activity extends AppCompatActivity {\r\n    TextView test;\r\n    String email, getmail, dateString;//\r\n    RequestQueue requestQueue;\r\n    //com.example.easybus.FloatingActionButton f;\r\n\r\n    LocationManager locationManager;               //宣告定位管理控制\r\n\r\n    private String provider;\r\n\r\n    double latitude, longitude;\r\n    String TAG = \"Page3Activity\";\r\n    //int LOCATION_REQUEST_CODE = 10001;\r\n    FusedLocationProviderClient fusedLocationProviderClient;\r\n    LocationRequest locationRequest;\r\n\r\n    static Page3Activity instance;\r\n\r\n    public static Page3Activity getInstance() {\r\n        return instance;\r\n    }\r\n\r\n\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_page3);\r\n       \r\n        instance = this;\r\n\r\n        Dexter.withActivity(this)\r\n                .withPermission(ACCESS_FINE_LOCATION)\r\n                .withListener(new PermissionListener() {\r\n                    @Override\r\n                    public void onPermissionGranted(PermissionGrantedResponse response) {\r\n\r\n                    updataLocation();\r\n\r\n                    }\r\n\r\n                    @Override\r\n                    public void onPermissionDenied(PermissionDeniedResponse response) {\r\n                        //Toast.makeText(Page3Activity.this, \"You must accept this location .\", Toast.LENGTH_SHORT).show();\r\n                    }\r\n\r\n                    @Override\r\n                    public void onPermissionRationaleShouldBeShown(PermissionRequest permission, PermissionToken token) {\r\n\r\n                    }\r\n                }).check();\r\n\r\n\r\n\r\n        requestQueue = Volley.newRequestQueue(this);\r\n        //抓email\r\n        SharedPreferences email = getSharedPreferences(\"email\", MODE_PRIVATE);\r\n        getmail = email.getString(\"Email\", \"\");\r\n        //dateString = date();\r\n        //隱藏title bar\r\n        ActionBar actionBar = getSupportActionBar();\r\n        actionBar.hide();\r\n\r\n        //跳頁到新增路線\r\n        Button btn1 = (Button) findViewById(R.id.btn1);\r\n        btn1.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent it1 = new Intent(Page3Activity.this, Page5011Activity.class);\r\n                //it1.putExtra(\"email\",getmail);\r\n                startActivity(it1);\r\n            }\r\n        });\r\n\r\n        //跳頁到搭車\r\n        Button btn2 = (Button) findViewById(R.id.btn2);\r\n        btn2.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent it2 = new Intent(Page3Activity.this, Page61.class);\r\n                //it2.putExtra(\"email\",getmail);\r\n                startActivity(it2);\r\n            }\r\n        });\r\n\r\n        //跳頁到注意事項\r\n        Button btn3 = (Button) findViewById(R.id.btn3);\r\n        btn3.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent it3 = new Intent(Page3Activity.this, Page7Activity.class);\r\n                //it3.putExtra(\"email\",getmail);\r\n                startActivity(it3);\r\n            }\r\n        });\r\n\r\n        //跳頁到我的帳戶\r\n        Button btn4 = (Button) findViewById(R.id.btn4);\r\n        btn4.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent it4 = new Intent(Page3Activity.this, Page8Activity.class);\r\n                // it4.putExtra(\"email\",getmail);\r\n                // Toast.makeText(Page3Activity.this, getmail, Toast.LENGTH_SHORT).show();\r\n                startActivity(it4);\r\n            }\r\n        });\r\n\r\n        //浮動按鈕撥打給緊急聯絡人\r\n        FloatingActionButton fab = (FloatingActionButton) findViewById(R.id.fab);\r\n        fab.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                readUser();\r\n            }\r\n        });\r\n        //取得定位權限\r\n        //locationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE);\r\n        //locationRequest = LocationRequest.create();\r\n       // init();\r\n    }\r\n\r\n    private void updataLocation() {\r\n        buildLocationRequest();\r\n        fusedLocationProviderClient = LocationServices.getFusedLocationProviderClient(this);\r\n        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n       // if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED\r\n         //       && ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n\r\n            return;\r\n        }\r\n        fusedLocationProviderClient.requestLocationUpdates(locationRequest, getPendingIntent());\r\n\r\n    }\r\n\r\n    private PendingIntent getPendingIntent() {\r\n        Intent intent = new Intent(Page3Activity.this,MyLocationService.class);\r\n        intent.setAction(MyLocationService.ACTION_PROCESS_UPDATE);\r\n        return PendingIntent.getBroadcast(this,0,intent,PendingIntent.FLAG_UPDATE_CURRENT);\r\n    }\r\n\r\n    private void buildLocationRequest() {\r\n        locationRequest = new LocationRequest();\r\n        locationRequest.setInterval(1000*10); //設置活動位置更新所需的時間間隔，以毫秒為單位\r\n        locationRequest.setFastestInterval(1000*10); //顯式設置位置更新的最快間隔，以毫秒為單位\r\n        locationRequest.setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY); //設置請求的優先級\r\n        locationRequest.setSmallestDisplacement(10f); //以米為單位設置位置更新之間的最小位移\r\n\r\n    }\r\n    public  void UpdateUser2(final String email,final double longitude,final double latitude){\r\n        Page3Activity.this.runOnUiThread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n               // test.setText(value);\r\n                dateString = date();\r\n                String URL = Urls.url1+\"/LoginRegister/save_perhistory.php\";\r\n                StringRequest stringRequest = new StringRequest(\r\n                        Request.Method.POST,\r\n                        URL,\r\n                        new Response.Listener<String>() {\r\n                            @Override\r\n                            public void onResponse(String response) {\r\n                                if(response.equals(\"Success\")){\r\n                                    // String s =\"已將 \"+phone+\" 設為緊急聯絡電話\";\r\n                                    // Toast.makeText(Page3Activity.this, s, Toast.LENGTH_SHORT).show();\r\n\r\n                                }\r\n                            }\r\n                        },\r\n                        new Response.ErrorListener() {\r\n                            @Override\r\n                            public void onErrorResponse(VolleyError error) {\r\n                               // Toast.makeText(Page3Activity.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                            }\r\n                        }\r\n                ) {\r\n                    @Nullable\r\n                    @Override\r\n                    protected Map<String, String> getParams() throws AuthFailureError {\r\n                        Map<String, String> parms = new HashMap<>();\r\n                        parms.put(\"email\", email);\r\n                        parms.put(\"date\", dateString);\r\n                        parms.put(\"longitude\", Double.toString(longitude));\r\n                        parms.put(\"latitude\", Double.toString(latitude));\r\n                        return parms;\r\n                    }\r\n                };\r\n                requestQueue.add(stringRequest);\r\n\r\n\r\n            }\r\n        });\r\n    }\r\n    public void updateToast(final String value){\r\n        Page3Activity.this.runOnUiThread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                //.makeText(Page3Activity.this, value, Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n    }\r\n\r\n    private  String  date(){\r\n        //目前時間\r\n        Date date = new Date();\r\n        //設定日期格式\r\n        @SuppressLint(\"SimpleDateFormat\")\r\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\r\n        sdf.setTimeZone(TimeZone.getTimeZone(\"GMT+08:00\"));  //加上J個\r\n        //進行轉換\r\n        dateString = sdf.format(date);\r\n\r\n        return dateString;\r\n    }\r\n\r\n\r\n    @SuppressLint(\"LongLogTag\")\r\n    protected void makeCall(final String phone) {\r\n        //Snackbar.make(v,\"打電話給緊急連絡人\",Snackbar.LENGTH_LONG).setAction(\"Action\",null).show();\r\n        Intent call = new Intent(Intent.ACTION_DIAL);\r\n        Uri u = Uri.parse(\"tel:\"+phone);\r\n        call.setData(u);\r\n\r\n        try {\r\n            startActivity(call);\r\n            finish();\r\n            Log.i(\"Finished making a call...\", \"\");\r\n        } catch (android.content.ActivityNotFoundException ex) {\r\n            //Toast.makeText(Page3Activity.this, ex.toString(), Toast.LENGTH_SHORT).show();\r\n            Toast.makeText(Page3Activity.this,\r\n                    \"Call faild, please try again later.\", Toast.LENGTH_SHORT).show();\r\n        }\r\n        //startActivity(call        );\r\n    }\r\n    public void readUser(){\r\n        String URL =Urls.url1+\"/LoginRegister/fetch.php?email=\"+getmail;\r\n        JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(\r\n                Request.Method.GET,\r\n                URL,\r\n                null,\r\n                new Response.Listener<JSONObject>() {\r\n                    String emergency_phone;\r\n                    @Override\r\n                    public void onResponse(JSONObject response) {\r\n                        try {\r\n                            emergency_phone = response.getString(\"emergency_contact\");\r\n                            makeCall(emergency_phone);\r\n                        } catch (JSONException e) {\r\n                            e.printStackTrace();\r\n                            //Toast.makeText(Page3Activity.this, e.toString(), Toast.LENGTH_SHORT).show();\r\n                        }\r\n                    }\r\n                },\r\n                new Response.ErrorListener() {\r\n                    @Override\r\n                    public void onErrorResponse(VolleyError error) {\r\n                       // Toast.makeText(Page3Activity.this, error.toString(), Toast.LENGTH_SHORT).show();\r\n                    }\r\n                }\r\n        );\r\n        requestQueue.add(jsonObjectRequest);\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/easybus/Page3Activity.java b/app/src/main/java/com/example/easybus/Page3Activity.java
--- a/app/src/main/java/com/example/easybus/Page3Activity.java	(revision 42c71929a2755119d3f6fee00894c3d3121fda86)
+++ b/app/src/main/java/com/example/easybus/Page3Activity.java	(date 1637739586467)
@@ -226,7 +226,8 @@
         locationRequest.setInterval(1000*10); //設置活動位置更新所需的時間間隔，以毫秒為單位
         locationRequest.setFastestInterval(1000*10); //顯式設置位置更新的最快間隔，以毫秒為單位
         locationRequest.setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY); //設置請求的優先級
-        locationRequest.setSmallestDisplacement(10f); //以米為單位設置位置更新之間的最小位移
+        //locationRequest.setSmallestDisplacement(10f); //以米為單位設置位置更新之間的最小位移
+        locationRequest.setSmallestDisplacement(100); //以米為單位設置位置更新之間的最小位移
 
     }
     public  void UpdateUser2(final String email,final double longitude,final double latitude){
Index: app/src/main/java/com/example/easybus/Urls.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.easybus;\r\n/*ip*/\r\nimport java.net.InetAddress;\r\nimport java.net.UnknownHostException;\r\n\r\npublic class Urls {\r\n    //private local InetAddress ip IPv4\r\n    public static String url1 = \"http://192.168.27.110\";\r\n    }
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/easybus/Urls.java b/app/src/main/java/com/example/easybus/Urls.java
--- a/app/src/main/java/com/example/easybus/Urls.java	(revision 42c71929a2755119d3f6fee00894c3d3121fda86)
+++ b/app/src/main/java/com/example/easybus/Urls.java	(date 1637735676960)
@@ -5,5 +5,5 @@
 
 public class Urls {
     //private local InetAddress ip IPv4
-    public static String url1 = "http://192.168.27.110";
+    public static String url1 = "http://120.110.112.63";
     }
\ No newline at end of file
Index: .idea/runConfigurations.xml
===================================================================
diff --git a/.idea/runConfigurations.xml b/.idea/runConfigurations.xml
deleted file mode 100644
--- a/.idea/runConfigurations.xml	(revision 42c71929a2755119d3f6fee00894c3d3121fda86)
+++ /dev/null	(revision 42c71929a2755119d3f6fee00894c3d3121fda86)
@@ -1,13 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<project version="4">
-  <component name="RunConfigurationProducerService">
-    <option name="ignoredProducers">
-      <set>
-        <option value="com.android.tools.idea.compose.preview.runconfiguration.ComposePreviewRunConfigurationProducer" />
-        <option value="org.jetbrains.plugins.gradle.execution.test.runner.AllInPackageGradleConfigurationProducer" />
-        <option value="org.jetbrains.plugins.gradle.execution.test.runner.TestClassGradleConfigurationProducer" />
-        <option value="org.jetbrains.plugins.gradle.execution.test.runner.TestMethodGradleConfigurationProducer" />
-      </set>
-    </option>
-  </component>
-</project>
\ No newline at end of file
Index: .idea/gradle.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"GradleMigrationSettings\" migrationVersion=\"1\" />\r\n  <component name=\"GradleSettings\">\r\n    <option name=\"linkedExternalProjectsSettings\">\r\n      <GradleProjectSettings>\r\n        <option name=\"delegatedBuild\" value=\"true\" />\r\n        <option name=\"testRunner\" value=\"PLATFORM\" />\r\n        <option name=\"distributionType\" value=\"DEFAULT_WRAPPED\" />\r\n        <option name=\"externalProjectPath\" value=\"$PROJECT_DIR$\" />\r\n        <option name=\"modules\">\r\n          <set>\r\n            <option value=\"$PROJECT_DIR$\" />\r\n            <option value=\"$PROJECT_DIR$/Modules\" />\r\n            <option value=\"$PROJECT_DIR$/app\" />\r\n            <option value=\"$PROJECT_DIR$/module\" />\r\n          </set>\r\n        </option>\r\n        <option name=\"resolveModulePerSourceSet\" value=\"false\" />\r\n        <option name=\"useQualifiedModuleNames\" value=\"true\" />\r\n      </GradleProjectSettings>\r\n    </option>\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/gradle.xml b/.idea/gradle.xml
--- a/.idea/gradle.xml	(revision 42c71929a2755119d3f6fee00894c3d3121fda86)
+++ b/.idea/gradle.xml	(date 1637735421319)
@@ -5,7 +5,7 @@
     <option name="linkedExternalProjectsSettings">
       <GradleProjectSettings>
         <option name="delegatedBuild" value="true" />
-        <option name="testRunner" value="PLATFORM" />
+        <option name="testRunner" value="GRADLE" />
         <option name="distributionType" value="DEFAULT_WRAPPED" />
         <option name="externalProjectPath" value="$PROJECT_DIR$" />
         <option name="modules">
@@ -17,7 +17,6 @@
           </set>
         </option>
         <option name="resolveModulePerSourceSet" value="false" />
-        <option name="useQualifiedModuleNames" value="true" />
       </GradleProjectSettings>
     </option>
   </component>
Index: .idea/compiler.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"CompilerConfiguration\">\r\n    <bytecodeTargetLevel target=\"13\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/compiler.xml b/.idea/compiler.xml
--- a/.idea/compiler.xml	(revision 42c71929a2755119d3f6fee00894c3d3121fda86)
+++ b/.idea/compiler.xml	(date 1637735512512)
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
   <component name="CompilerConfiguration">
-    <bytecodeTargetLevel target="13" />
+    <bytecodeTargetLevel target="11" />
   </component>
 </project>
\ No newline at end of file
Index: .idea/misc.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ProjectRootManager\" version=\"2\" languageLevel=\"JDK_13\" default=\"false\" project-jdk-name=\"1.8\" project-jdk-type=\"JavaSDK\">\r\n    <output url=\"file://$PROJECT_DIR$/build/classes\" />\r\n  </component>\r\n  <component name=\"ProjectType\">\r\n    <option name=\"id\" value=\"Android\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/misc.xml b/.idea/misc.xml
--- a/.idea/misc.xml	(revision 42c71929a2755119d3f6fee00894c3d3121fda86)
+++ b/.idea/misc.xml	(date 1637735512497)
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
-  <component name="ProjectRootManager" version="2" languageLevel="JDK_13" default="false" project-jdk-name="1.8" project-jdk-type="JavaSDK">
+  <component name="ProjectRootManager" version="2" languageLevel="JDK_11" default="true" project-jdk-name="11" project-jdk-type="JavaSDK">
     <output url="file://$PROJECT_DIR$/build/classes" />
   </component>
   <component name="ProjectType">
